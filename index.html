<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gest√£o FIE 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        /* MAPA */
        .estande { 
            fill: rgba(255, 255, 255, 0.5); 
            cursor: pointer; 
            transition: all 0.2s ease; 
            stroke-width: 2px; 
            stroke: #94a3b8; 
            pointer-events: auto; 
        }
        .estande:hover { 
            stroke-width: 8px !important; 
            stroke: #2563eb !important; 
            filter: brightness(0.9);
            z-index: 100;
        }
        
        /* STATUS */
        .status-construido { stroke: #16a34a !important; stroke-width: 5px; } 
        .status-em_construcao { stroke: #ea580c !important; stroke-width: 5px; stroke-dasharray: 10,5; }
        .status-nao_iniciado { stroke: #94a3b8 !important; stroke-width: 2px; }

        /* UTIL */
        .estande-match { stroke: #000 !important; stroke-width: 10px !important; fill-opacity: 1 !important; z-index: 50; }
        .estande-dimmed { opacity: 0.15; }
        .loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; color: #475569; }
        
        .map-scroll-container {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            background: white;
            position: relative;
            max-height: 80vh;
        }

        /* MODAL ANIMATION */
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .anim-modal { animation: zoomIn 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800 pb-20">

    <div id="loading" class="loading-overlay">
        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
        <span>Carregando Sistema...</span>
    </div>

    <div id="modal-edit" class="fixed inset-0 bg-slate-900/90 z-[9999] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden anim-modal border border-white/20">
            <div class="bg-blue-900 p-4 text-white flex justify-between items-center">
                <div>
                    <span class="text-[10px] uppercase font-bold opacity-60 tracking-wider">Editar Estande</span>
                    <h3 id="modal-title" class="text-xl font-black uppercase tracking-tight truncate max-w-[220px]">...</h3>
                </div>
                <button onclick="window.fecharModal()" class="text-white/70 hover:text-white text-3xl p-2 cursor-pointer">&times;</button>
            </div>
            
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nome do Produtor</label>
                    <input type="text" id="input-produtor" placeholder="Digite o nome..." class="w-full border-2 border-slate-200 rounded-xl p-3 font-bold text-slate-700 outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Equipe de Marcenaria (Cor)</label>
                    <div class="relative">
                        <select id="select-marcenaria" class="w-full border-2 border-slate-200 rounded-xl p-3 font-bold text-slate-700 outline-none bg-slate-50 appearance-none h-12">
                            <option value="">-- Sem Marcenaria --</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">‚ñº</div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Status da Obra</label>
                    <div class="relative">
                        <select id="select-status" class="w-full border-2 border-slate-200 rounded-xl p-3 font-bold text-slate-600 outline-none bg-white appearance-none h-12">
                            <option value="nao_iniciado">‚ö™ N√£o Iniciado</option>
                            <option value="em_construcao">üöß Em Constru√ß√£o</option>
                            <option value="construido">‚úÖ Constru√≠do</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">‚ñº</div>
                    </div>
                </div>

                <a id="btn-link-externo" href="#" target="_blank" class="hidden flex items-center justify-center gap-2 w-full py-4 bg-cyan-50 text-cyan-700 rounded-xl border-2 border-cyan-100 font-black text-xs uppercase hover:bg-cyan-100 transition shadow-sm">
                    üìÇ ACESSAR PASTA DRIVE
                </a>

                <div class="flex gap-3 pt-2 border-t border-slate-100 mt-2">
                    <button onclick="window.limparEstandeIndividual()" class="w-12 flex items-center justify-center bg-red-50 text-red-500 rounded-xl font-bold border border-red-100 hover:bg-red-500 hover:text-white transition cursor-pointer" title="Limpar">üóëÔ∏è</button>
                    <button onclick="window.salvarEstande()" class="flex-1 py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-black uppercase text-sm shadow-lg transition active:scale-95 cursor-pointer">CONFIRMAR</button>
                </div>
            </div>
        </div>
    </div>

    <div class="w-full px-2 md:px-8 pb-10 space-y-6">
        <div class="flex flex-col lg:flex-row justify-between items-center gap-4 bg-white p-4 rounded-b-2xl shadow-sm border-x border-b border-slate-200 sticky top-0 z-40">
            <div class="flex flex-col md:flex-row items-center gap-2 md:gap-4 w-full md:w-auto">
                <h1 class="text-xl md:text-2xl font-black text-slate-800 uppercase italic tracking-tighter">FIE 2025</h1>
                <div class="flex items-center gap-2 w-full md:w-auto bg-slate-50 px-3 py-1 rounded-full border border-slate-200">
                    <div class="w-24 md:w-32 bg-slate-200 h-2 rounded-full overflow-hidden">
                        <div id="progress-bar" class="bg-green-500 h-full w-0 transition-all duration-700"></div>
                    </div>
                    <span id="progress-text" class="text-xs font-black text-green-600">0%</span>
                </div>
            </div>
            <div class="flex w-full md:w-auto gap-2">
                <button onclick="window.exportarXLS()" class="flex-1 md:flex-none px-4 py-2 bg-green-600 text-white rounded-lg text-xs font-bold uppercase shadow hover:bg-green-700 cursor-pointer">Excel</button>
                <button onclick="window.resetarDados()" class="flex-1 md:flex-none px-4 py-2 bg-white border border-red-200 text-red-500 rounded-lg text-xs font-bold uppercase hover:bg-red-50 cursor-pointer">Reset</button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow border border-slate-200 p-4">
            <h3 class="text-xs font-black text-slate-400 uppercase mb-3 border-b pb-2">Cadastrar Equipe de Marcenaria</h3>
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex gap-2 w-full md:w-1/3">
                    <input type="text" id="novo-nome-marcenaria" placeholder="Nome da Marcenaria" class="flex-1 border-2 border-slate-200 rounded-lg px-3 py-2 text-sm font-semibold outline-none focus:border-blue-500">
                    <input type="color" id="nova-cor-marcenaria" value="#2563eb" class="h-10 w-12 rounded cursor-pointer border-0 p-0 bg-transparent shrink-0">
                    <button onclick="window.adicionarMarcenaria()" class="px-4 bg-slate-800 text-white rounded-lg text-xs font-bold uppercase hover:bg-slate-900 cursor-pointer">+ Criar</button>
                </div>
                <div id="lista-marcenarias-container" class="flex flex-wrap gap-2 overflow-x-auto pb-2 md:pb-0 w-full"></div>
            </div>
        </div>

        <div class="relative">
            <input type="text" id="search-input" placeholder="üîç Buscar..." class="w-full bg-white rounded-xl px-4 py-3 shadow-md border border-slate-200 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div class="space-y-2">
            <h2 class="text-lg font-black text-blue-800 border-l-4 border-blue-600 pl-3">üìç Pavilh√£o Leste</h2>
            <div class="map-scroll-container shadow-xl">
                <div class="min-w-[1000px] md:min-w-full relative group">
                    <img src="PB-FEIRA DA INDUSTRIA-2025-REV 36-ESPA√áO LIVRE X OCUPADOS (1)_pages-to-jpg-0002.jpg" class="w-full h-auto block opacity-60 pointer-events-none relative z-0">
                    <svg viewBox="0 0 4963 3509" class="absolute top-0 left-0 w-full h-full z-10" xmlns="http://www.w3.org/2000/svg">
                        <polygon class="estande" points="903,1596 982,1622 1048,1478 973,1443"><title>Pena 02 03</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1UQl3ZFZRBQuzyzdNShfngPbshaTr7Z8G?usp=sharing"><polygon class="estande" points="1122,1378 991,1391 969,1439 1148,1514"><title>Grendene 04</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="1048,1483 1144,1518 1166,1628 1100,1676 986,1628"><title>IEL 05</title></polygon></a>
                        <polygon class="estande" points="925,1650 1078,1720 1091,1825 965,1930"><title>Beatriz Textil 01</title></polygon>
                        <polygon class="estande" points="1087,2114 1223,1991 1205,1886 1126,1851 965,1991"><title>SindRoupas 34 36 37</title></polygon>
                        <polygon class="estande" points="1175,1369 1302,1347 1450,1514 1288,1649 1210,1614"><title>Grupo Argo 06 07 08 09</title></polygon>
                        <polygon class="estande" points="1319,1682 1411,1599 1494,1678 1337,1708"><title>RevaMond 19</title></polygon>
                        <polygon class="estande" points="1481,1544 1420,1601 1494,1684 1590,1667"><title>Atelie Silvana de deus 18</title></polygon>
                        <a href="https://drive.google.com/drive/folders/12lZF_uPdwf4sZX9Qu2s0_hTUDcOpa75u?usp=sharing"><polygon class="estande" points="1498,1734 1455,1835 1332,1778 1341,1752"><title>Tramix 21</title></polygon></a>
                        <polygon class="estande" points="1590,1715 1529,1872 1455,1833 1494,1728"><title>Boa kostura 20</title></polygon>
                        <polygon class="estande" points="1253,1871 1319,1827 1433,1880 1367,2028 1266,1985"><title>Handara 33</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1DyzPGIUn9HqxcIJ1UxacX3SEjSbj_BcQ?usp=sharing"><polygon class="estande" points="1332,2118 1372,2030 1442,2061 1420,2114"><title>Asa sul 32A</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/16uooWZJDPPS4YeV6f7AzkMfp7ye-Lpbc?usp=sharing"><polygon class="estande" points="1481,1471 1542,1423 1494,1370 1428,1414"><title>Sindcalf 10</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1jPl_Lc3feJLqnRpsG890Qt4NsQKmpUd0?usp=sharing"><polygon class="estande" points="1573,1451 1630,1525 1568,1573 1512,1512"><title>Revid 16</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1IPsS2jkrnP79HKwaMsDP7P5Cx3IMgBVr?usp=sharing"><polygon class="estande" points="1634,1517 1739,1644 1639,1657 1568,1570"><title>Fortmix 15</title></polygon></a>
                        <polygon class="estande" points="1582,1458 1735,1642 1796,1589 1770,1432 1700,1349"><title>Sesi/Senai Moda 13 14 17</title></polygon>
                        <a href="https://drive.google.com/drive/folders/12f7NIkhxXRLEg7KEEl04tKlX22_eAey1?usp=sharing"><polygon class="estande" points="1744,1694 1814,1724 1849,1882 1827,1917 1687,1838"><title>Sindi Industria 25</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/11zG1mxlgR3bFdGbx5ZS23J_ON4Qw2eT-?usp=sharing"><polygon class="estande" points="1761,1878 1831,1904 1800,1983 1726,1952"><title>Clipper 26</title></polygon></a>
                        <polygon class="estande" points="1962,1270 1709,1279 1796,1384 1905,1379"><title>Sesi/senai Leste</title></polygon>
                        <polygon class="estande" points="2216,1260 2151,1383 2011,1291 2024,1260"><title>Apodi</title></polygon>
                        <polygon class="estande" points="2085,1628 1989,1628 1923,1584 1923,1422 1984,1330 2190,1462"><title>Sinduscon 10 11 12 13 14</title></polygon>
                        <polygon class="estande" points="1945,1900 1923,1870 1923,1721 1993,1677 2076,1817"><title>`Rejuntamix 53</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1TZmzhWBf67cjniQvaZ1I7FphRH-pJcEi?usp=sharing"><polygon class="estande" points="2146,1930 2225,2035 2024,2044 2015,2013"><title>Sesi/Senai 49</title></polygon></a>
                        <polygon class="estande" points="2229,1491 2304,1539 2247,1626 2146,1626"><title>SindSerrais 09</title></polygon>
                        <a href="https://drive.google.com/drive/folders/16c7WvZqiqGC0AC1MZRRXzsdwahGMrjMx?usp=sharing"><polygon class="estande" points="2435,1747 2505,1778 2509,1891 2413,1953 2326,1808"><title>SindCeramica 43</title></polygon></a>
                        <polygon class="estande" points="2256,1441 2439,1568 2505,1524 2505,1266 2374,1262"><title>Sindmoveis 04 05 06 07</title></polygon>
                        <polygon class="estande" points="2558,1521 2632,1560 2798,1446 2689,1267 2558,1263"><title>Sindmoveis 15 16 17 18</title></polygon>
                        <polygon class="estande" points="2654,1600 2663,1626 2820,1626 2763,1535"><title>CNP 28</title></polygon>
                        <a href="https://drive.google.com/drive/folders/18R-1U8jAyyWI5grddvU8xkMJ7tFgT_Dk?usp=sharing"><polygon class="estande" points="2562,2035 2689,2039 2798,1851 2628,1742 2553,1781"><title>Simagram 39 40 41 42</title></polygon></a>
                        <polygon class="estande" points="2986,1485 3118,1402 3140,1420 3144,1582 3070,1625"><title>Romazi 25</title></polygon>
                        <polygon class="estande" points="2916,1773 3122,1908 3140,1882 3140,1716 3078,1672 2969,1676"><title>Sincompe 31 32</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1uIk3SdbL3yZ4zd3a_YAw0Su_p1EOv8Uk?usp=sharing"><polygon class="estande" points="2916,1922 3057,2014 3039,2040 2838,2036"><title>Sesi/Senai 36</title></polygon></a>
                        <polygon class="estande" points="3100,1264 3192,1426 3227,1430 3350,1282"><title>Sesi/Senai</title></polygon>
                        <polygon class="estande" points="3267,1589 3323,1641 3433,1519 3310,1414 3288,1444"><title>Acellormittal 11</title></polygon>
                        <a href="https://drive.google.com/drive/folders/10PY2vs8ird5Y927Oo7toCZt4lMApHJE9?usp=sharing"><polygon class="estande" points="3358,1347 3429,1408 3376,1465 3310,1408"><title>TotalDesign 12 </title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1a7vuUcSkchzVfbFDVjKNtDoVaf93z6J2?usp=sharing"><polygon class="estande" points="3367,1467 3490,1568 3547,1511 3424,1410"><title>Grupo 3G 13 14</title></polygon></a>
                        <polygon class="estande" points="3433,1515 3494,1568 3420,1660 3328,1642"><title>`Br hidraulica 10</title></polygon>
                        <polygon class="estande" points="3240,1729 3315,1694 3420,1708 3490,1878 3262,1988 3218,1883"><title>Cemag 50 51 52 53 </title></polygon>
                        <polygon class="estande" points="3284,2026 3293,2056 3490,2083 3433,1960"><title>Central das correias 49</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1vCjWd1-pXA-5UB3m1lZ6DJX4izSsSAp1?usp=sharing"><polygon class="estande" points="3507,1924 3542,2003 3464,2034 3433,1964"><title>Durametal 47</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1rLUlZgqV128MFbqO8PB3AZrzwJMn5z-l?usp=sharing"><polygon class="estande" points="3542,2010 3586,2106 3499,2088 3468,2036"><title>Biomatika 48</title></polygon></a>
                        <polygon class="estande" points="3555,1913 3630,1874 3695,2027 3621,2058"><title>Sabao jau 45 46</title></polygon>
                        <polygon class="estande" points="3630,1880 3748,1827 3814,1875 3770,2129 3643,2107 3621,2063 3695,2024"><title>Sindquimica 43 44</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1tLn4jBVTrjQA536B11E9wHUqiWZ6oW5R?usp=sharing"><polygon class="estande" points="3730,1382 3787,1439 3730,1496 3674,1452"><title>Usb 05</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1rxf0llp24b-4ANL-8F8LwJ4YD-XPP7M8?usp=sharing"><polygon class="estande" points="3735,1503 3678,1564 3621,1512 3674,1450"><title>Simec 04</title></polygon></a>
                        <polygon class="estande" points="3787,1447 3871,1512 3853,1617 3774,1648 3678,1561"><title>Aco cearense 07</title></polygon>
                        <polygon class="estande" points="4120,1515 4050,1550 4015,1476 4085,1441"><title>Sindcarnauba 16</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1jtXiPqMYBUCybcg6nG3H6II3sLCWgy6R?usp=sharing"><polygon class="estande" points="4124,1524 4159,1594 4081,1629 4046,1554"><title>Conexao brindes 17</title></polygon></a>
                        <polygon class="estande" points="3984,1719 3989,1749 4238,1784 4173,1635"><title>Sesi/senai 27 28 </title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/1OuUG2nJsENEqoF9-Yu2j_-HJ4Ea3uh5V?usp=sharing"><polygon class="estande" points="4142,1825 4063,1903 3967,1816 3980,1794"><title>Netonda 29 </title></polygon></a>
                        <polygon class="estande" points="3936,1859 3862,1881 3840,1990 3923,2060 4032,1942"><title>Projeart 42</title></polygon>
                        <polygon class="estande" points="4093,1996 3953,2162 3818,2140 3848,1996 3927,2066 4036,1944"><title>Sindquimica 39 40 41</title></polygon>
                        <a href="https://drive.google.com/drive/folders/1X4iZy0bn3fQ7xidVwRukQr6Hfh0Z6p73?usp=sharing"><polygon class="estande" points="4129,2029 4194,2086 4138,2143 4076,2086"><title>NobreTc 38</title></polygon></a>
                        <a href="https://drive.google.com/drive/folders/18biu6rWqxItznCAX4jgQxIA2EcGHJ04_?usp=sharing"><polygon class="estande" points="4291,1587 4326,1662 4256,1692 4221,1618"><title>Sankhya 22</title></polygon></a>
                    </svg>
                </div>
            </div>

            <div class="space-y-2">
                <h2 class="text-lg font-black text-orange-600 border-l-4 border-orange-500 pl-3">üìç Pavilh√£o Oeste</h2>
                <div class="map-scroll-container shadow-xl">
                    <div class="min-w-[1000px] md:min-w-full relative group">
                        <img src="PB-FEIRA DA INDUSTRIA-2025-REV 36-ESPA√áO LIVRE X OCUPADOS (1)_pages-to-jpg-0003.jpg" class="w-full h-auto block opacity-60 pointer-events-none relative z-0">
                        <svg viewBox="0 0 4963 3509" class="absolute top-0 left-0 w-full h-full z-10" xmlns="http://www.w3.org/2000/svg">
                            <polygon class="estande" points="719,930 698,952 890,1122 1013,978"><title>Adece 02</title></polygon>
                            <a href="https://drive.google.com/drive/folders/14CHWr9btxvTlCGFCt9OkrJz49AFfKUdy?usp=sharing"><polygon class="estande" points="671,987 1052,1329 1043,1359 628,1294 562,1246 588,1079"><title>Fiec 01</title></polygon></a>
                            <polygon class="estande" points="1205,1008 1074,991 1004,1065 1175,1218"><title>Imprensa 03</title></polygon>
                            <polygon class="estande" points="1004,1066 1179,1215 1166,1267 1087,1298 930,1153"><title>CNI 04</title></polygon>
                            <polygon class="estande" points="549,1374 623,1339 719,1356 794,1544 566,1640 518,1540"><title>Sindicatos 21 22</title></polygon>
                            <polygon class="estande" points="588,1682 593,1717 890,1757 816,1586"><title>Sindicatos 20</title></polygon>
                            <polygon class="estande" points="776,1358 838,1516 1035,1432 1030,1402"><title>Arcepp 19</title></polygon>
                            <polygon class="estande" points="859,1561 912,1675 1122,1591 1122,1526 1056,1473"><title>Estudio de comunicacao 18</title></polygon>
                            <polygon class="estande" points="912,1677 951,1769 1083,1791 1113,1585"><title>BB 17</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="1389,1048 1258,1018 1214,1280 1280,1328 1477,1245"><title>IEL 05 06</title></polygon></a>
                            <polygon class="estande" points="1621,1451 1722,1469 1800,1429 1818,1267 1774,1167 1542,1267"><title>Sebrae 09 10</title></polygon>
                            <polygon class="estande" points="1450,1044 1744,1097 1757,1127 1525,1228 1529,1229"><title>Faculdades 08</title></polygon>
                            <polygon class="estande" points="1498,1289 1564,1442 1306,1402 1297,1372"><title>Sebrae 07</title></polygon>
                            <polygon class="estande" points="1372,1545 1428,1468 1297,1446 1284,1473 1358,1545 1428,1467"><title>Makro 14A</title></polygon>
                            <polygon class="estande" points="1555,1490 1446,1613 1363,1543 1428,1468"><title>Cegas 14</title></polygon>
                            <a href="https://drive.google.com/drive/folders/13CJ0MWXuu5z6B9iH6UYrRxRYpWK_QCEV?usp=sharing"><polygon class="estande" points="1253,1514 1175,1536 1135,1799 1266,1816 1411,1654"><title>Sesi/Senai 15 16</title></polygon></a>
                            <polygon class="estande" points="1617,1498 1709,1519 1787,1568 1748,1738 1555,1568"><title>BNB 11</title></polygon>
                            <polygon class="estande" points="1560,1564 1739,1726 1674,1813 1481,1647"><title>CEF 12</title></polygon>
                            <polygon class="estande" points="1621,1873 1643,1851 1450,1680 1323,1829"><title>13</title></polygon>
                            <polygon class="estande" points="1678,1878 1940,1900 1875,1790 1770,1782"><title>Sesi/Senai</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="1975,1161 1914,1253 1923,1419 1975,1467 2081,1467 2190,1301"><title>SindEnergia 10-14</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2002,1123 2019,1092 2317,1097 2216,1259"><title>SindEnergia 01 02 03</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2383,1096 2514,1091 2514,1363 2444,1402 2260,1288"><title>SindEnergia 04-07</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2229,1328 2413,1438 2404,1468 2142,1468"><title>SindEnergia 08 09</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1mXEGihwhcIXBPcWLVp0HvwInojREQO45?usp=sharing"><polygon class="estande" points="1984,1521 1914,1560 1914,1722 1932,1752 2072,1656"><title>Enel 53</title></polygon></a>
                            <polygon class="estande" points="1980,1521 2072,1657 2142,1617 2081,1512"><title>Startup-IST 54</title></polygon>
                            <a href="https://drive.google.com/drive/folders/14hEukvNMWbm0_7aKtskzdBrDxw5TehO9?usp=sharing"><polygon class="estande" points="1980,1825 2046,1773 1997,1707 1932,1742"><title>IMPTudo 52</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1HvGdeCHXN7BAjdTzeNhpa6WFZO9lfYtZ?usp=sharing"><polygon class="estande" points="2072,1664 2120,1729 2050,1769 2006,1703"><title>SindVerde 51</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1LByEgB03QnGcNFbd7zfVcx1Jj8lje4BT?usp=sharing"><polygon class="estande" points="2142,1618 2190,1684 2120,1727 2072,1657"><title>Idear 50</title></polygon></a>
                            <polygon class="estande" points="2002,1860 2019,1890 2312,1890 2216,1728"><title>Sesi/Senai 47 48 49</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1q2Jnv2FjG-jeTYyH9IGUNuqFSiJHlG8j?usp=sharing"><polygon class="estande" points="2348,1839 2509,1734 2514,1887 2378,1891"><title>BigDooh Midia Ooh 44</title></polygon></a>
                            <polygon class="estande" points="2256,1695 2439,1585 2514,1625 2509,1734 2348,1835"><title>Qair 43 45 46</title></polygon>
                            <polygon class="estande" points="2142,1512 2234,1656 2413,1538 2400,1516"><title>Carmehill 08 09</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2562,1097 2702,1097 2816,1281 2632,1395 2562,1369"><title>SindEnergia 15 16 17 18</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2658,1445 2842,1327 2925,1467 2667,1467"><title>SindEnergia 27 28</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2829,1516 2776,1612 2663,1542 2671,1516"><title>SindEnergia 29</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2632,1580 2562,1624 2566,1733 2658,1799 2746,1654"><title>SindEnergia 42</title></polygon></a>
                            <polygon class="estande" points="2562,1740 2566,1889 2698,1889 2728,1845"><title>SindGrafica 41</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1vl2KuNI_FKjHKfUfJeeN6awIO0OzmNoF?usp=sharing"><polygon class="estande" points="2772,1763 2811,1697 2746,1658 2702,1723"><title>Cobamp 39</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1zkjfgkB1VXYFf0-ry08-IfuASeEGfZHV?usp=sharing"><polygon class="estande" points="2763,1776 2702,1724 2658,1794 2728,1842"><title>SindPneu 40</title></polygon></a>
                            <polygon class="estande" points="2833,1512 2930,1517 2846,1661 2772,1613"><title>EnergiaLightcom 30</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2860,1259 3070,1124 3052,1093 2755,1097"><title>SindEnergia 19 20 21</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2886,1302 2991,1468 3092,1468 3000,1328 3144,1232 3096,1166"><title>SindEnergia 22 23 24 26</title></polygon></a>
                            <polygon class="estande" points="3004,1325 3140,1237 3157,1255 3162,1425 3092,1469"><title>Grupo Terlles 25</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1k86F3vThDPLEepa0Upi5xMz5YHBZR5EE?usp=sharing"><polygon class="estande" points="2986,1523 3092,1519 3000,1659 2930,1615"><title>Goodwe 31</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1Ct_Z1TrBGAw_1Viq6YPPG68H9y-4raZ9?usp=sharing"><polygon class="estande" points="2921,1617 3000,1661 2956,1726 2886,1682"><title>Lubtrol 35</title></polygon></a>
                            <polygon class="estande" points="3092,1520 3162,1564 3157,1638 3057,1577"><title>Dislub 32A</title></polygon>
                            <polygon class="estande" points="3052,1581 3030,1620 3000,1659 3148,1764 3157,1721 3157,1638"><title>Enie 32B</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1BRaXzC8t0zBRorUXLBBUr7fjaskTDOdh?usp=sharing"><polygon class="estande" points="3000,1663 3135,1751 3096,1825 2951,1729"><title>Energia Pecem 33 34</title></polygon></a>
                            <polygon class="estande" points="2811,1801 2881,1840 2930,1770 2855,1726"><title>38</title></polygon>
                            <polygon class="estande" points="2925,1773 3070,1861 3052,1891 2855,1887"><title>36</title></polygon>
                            <polygon class="estande" points="2807,1801 2759,1888 2860,1888 2877,1836"><title>37</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1gBICofXNIbF9BDwfMnTdomogbDHImKpR?usp=sharing"><polygon class="estande" points="3100,1897 3205,1735 3232,1735 3363,1880"><title>Sesi/Senai</title></polygon></a>
                            <polygon class="estande" points="3450,1194 3503,1063 3302,1094 3293,1124"><title>Frosty 01</title></polygon>
                            <polygon class="estande" points="3599,1053 3494,1061 3477,1114 3555,1140"><title>Itaueira 02</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1vGOjBJJoRe7V0OAu1ikf8XlsZcJzq8zC?usp=sharing"><polygon class="estande" points="3555,1149 3525,1219 3450,1188 3477,1114"><title>Milk 03</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1lRJ4vqJRuTxeziXn6yrP-bEx2wYtU-z2?usp=sharing"><polygon class="estande" points="3350,1201 3319,1279 3240,1249 3275,1170"><title>Alimempro ¬†12</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1FWE69FssQ4-Jgm8qgf4kPKv0FG5eHYoM?usp=sharing"><polygon class="estande" points="3411,1228 3389,1307 3315,1285 3350,1202"><title>Sindalimentos 13</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/13TG6Q2Yh65CK287jFVsZB8Gosveu57Ky?usp=sharing"><polygon class="estande" points="3420,1234 3503,1269 3464,1339 3389,1313"><title>Sindcafe 14</title></polygon></a>
                            <polygon class="estande" points="3389,1313 3328,1466 3253,1431 3227,1273 3236,1243"><title>Betania 11</title></polygon>
                            <polygon class="estande" points="3464,1346 3424,1447 3328,1460 3389,1316"><title>Diageo 10</title></polygon>
                            <polygon class="estande" points="3499,1704 3376,1809 3297,1726 3271,1564 3332,1512"><title>M dias 51 52 53</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1AFIQq15xBlxlTVMBIa8XV-r_NNwMAQIh?usp=sharing"><polygon class="estande" points="3424,1502 3503,1590 3446,1638 3332,1511"><title>Dikoko 54</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/14jCDtWXR3gZXYJ4565Yn5GhoETLguICz?usp=sharing"><polygon class="estande" points="3507,1587 3560,1648 3499,1705 3442,1639"><title>LDB 50</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1vr_rDkwHumjlmVPBZ1RtgXR2j9RS0e5P?usp=sharing"><polygon class="estande" points="3599,1686 3726,1831 3429,1874 3407,1848"><title>SindPan 47 48 49</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/144LcokE-liVFrgw6mlgvL9uZojTITzsY?usp=sharing"><polygon class="estande" points="3660,1040 3792,1018 3818,1167 3639,1088"><title>SindLacticinios ¬†04</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1T1ns61BOxmWCZB86Qd4_UNc95W0ukgGE?usp=sharing"><polygon class="estande" points="3630,1089 3713,1124 3674,1199 3604,1168"><title>Compex 07</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1aJim3BKnGbigVent_KEi9B2Ktm08GNrJ?usp=sharing"><polygon class="estande" points="3678,1202 3647,1267 3564,1246 3595,1176"><title>Especiarias da roca 06</title></polygon></a>
                            <polygon class="estande" points="3713,1125 3814,1173 3831,1278 3766,1331 3647,1274"><title>SindSorvetes 05</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1J4QiOmL4FLYlL7jgLuCCJdypwzQ6xFPN?usp=sharing"><polygon class="estande" points="3625,1321 3547,1286 3485,1444 3582,1422"><title>Fluido 09</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1PNMONo59ds69sxAc3jraDZYOypdAfycw?usp=sharing"><polygon class="estande" points="3625,1331 3744,1374 3739,1396 3582,1423"><title>Netumar 08</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1uWJ4kmmjzzd3yv3fBlvzp9PAyYJRrmXY?usp=sharing"><polygon class="estande" points="3604,1619 3660,1563 3586,1475 3494,1493 3564,1571"><title>Samaria 55</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/18sen-LQ1s_yb8rG3WFImeqEAhg0FPQIc?usp=sharing"><polygon class="estande" points="3752,1445 3761,1472 3660,1559 3586,1476"><title>Serra Grande 56</title></polygon></a>
                            <polygon class="estande" points="3700,1598 3752,1655 3687,1716 3630,1651"><title>Agromix 46</title></polygon>
                            <a href="https://drive.google.com/drive/folders/1OFcpges2pbJ8HGbxbAeMADgerDSQkr86?usp=sharing"><polygon class="estande" points="3796,1512 3875,1538 3888,1652 3809,1722 3695,1599"><title>J Macedo 43</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="3958,1296 3884,1274 3866,1160 3941,1086 4059,1213"><title>IEL 18 Oeste</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/181ORvZLpEE7IYgPKX5oVYxJghrJFLlzm?usp=sharing"><polygon class="estande" points="3989,1338 4006,1360 4159,1334 4089,1242"><title>Maria Pitanga 28</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1TO44cinqiLUHRBgFY-g9l-iFVgfkff2J?usp=sharing"><polygon class="estande" points="4155,1124 4221,1067 4159,1005 4098,1058"><title>Grupo Souza Miranda 21</title></polygon></a>
                            <polygon class="estande" points="3989,1479 3919,1532 3936,1632 4041,1680 4107,1527"><title>3 coracoes 42</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1gBICofXNIbF9BDwfMnTdomogbDHImKpR?usp=sharing"><polygon class="estande" points="4111,1543 4177,1565 4094,1766 3962,1783 3945,1639 4046,1683"><title>Sesi/Senai 39 40 41</title></polygon></a>
                            <a href="https://drive.google.com/drive/folders/1paJeqT_F1-lf33Rn-sxeqw211A-AVuzJ?usp=sharing"><polygon class="estande" points="4330,1580 4361,1501 4278,1462 4256,1536"><title>Puro acai 35</title></polygon></a>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200 mt-10">
            <div class="bg-slate-800 p-4"><h2 class="text-white font-bold uppercase tracking-wide">üìã Lista Geral (Banco de Dados)</h2></div>
            <div class="max-h-[500px] overflow-y-auto overflow-x-auto">
                <table class="w-full text-left min-w-[600px]">
                    <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Estande</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Produtor</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Marcenaria (Cor)</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500 text-center">Status</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500 text-right">A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="lista-estandes" class="divide-y divide-slate-100 text-sm font-medium text-slate-600"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCVbw_1Jl300_lOFBKGnRBa0Y-pptgMRe0",
            authDomain: "fiec2025-fab88.firebaseapp.com",
            databaseURL: "https://fiec2025-fab88-default-rtdb.firebaseio.com",
            projectId: "fiec2025-fab88",
            storageBucket: "fiec2025-fab88.firebasestorage.app",
            messagingSenderId: "29657094856",
            appId: "1:29657094856:web:c8a8e40aab6aa8722663fd",
            measurementId: "G-KYLG954HLH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ESTADO GLOBAL
        let DADOS = { estandes: {}, marcenarias: {} };
        let estandeSelecionado = null;

        // ELEMENTOS DO DOM
        const els = {
            modal: document.getElementById('modal-edit'),
            title: document.getElementById('modal-title'),
            produtor: document.getElementById('input-produtor'),
            marcenaria: document.getElementById('select-marcenaria'),
            status: document.getElementById('select-status'),
            linkBtn: document.getElementById('btn-link-externo'),
            search: document.getElementById('search-input'),
            tableBody: document.getElementById('lista-estandes'),
            progress: document.getElementById('progress-bar'),
            progressText: document.getElementById('progress-text'),
            loading: document.getElementById('loading'),
            marcenariaContainer: document.getElementById('lista-marcenarias-container')
        };

        // --- EXPORTAR FUN√á√ïES PARA O HTML (CRUCIAL PARA OS BOT√ïES FUNCIONAREM) ---
        
        window.adicionarMarcenaria = () => {
            const nome = document.getElementById('novo-nome-marcenaria').value.trim();
            const cor = document.getElementById('nova-cor-marcenaria').value;
            if(!nome) return alert("Nome obrigat√≥rio");
            
            // Sanitiza√ß√£o simples para chave do Firebase
            const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
            
            // Salva no banco
            set(ref(db, 'marcenarias/' + idSeguro), cor);
            document.getElementById('novo-nome-marcenaria').value = '';
        };

        window.removerMarcenaria = (nome) => {
            if(confirm(`Apagar marcenaria ${nome}?`)) {
                remove(ref(db, 'marcenarias/' + nome));
            }
        };

        window.salvarEstande = () => {
            if (!estandeSelecionado) return;
            const nome = estandeSelecionado.getAttribute('data-nome');
            const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
            
            set(ref(db, 'estandes/' + idSeguro), {
                produtor: els.produtor.value,
                marcenaria: els.marcenaria.value,
                status: els.status.value
            });
            window.fecharModal();
        };

        window.limparEstandeIndividual = () => {
            if (!estandeSelecionado) return;
            if(confirm('Limpar dados deste estande?')) {
                const nome = estandeSelecionado.getAttribute('data-nome');
                const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
                remove(ref(db, 'estandes/' + idSeguro));
                window.fecharModal();
            }
        };

        window.resetarDados = () => {
            if(confirm("ATEN√á√ÉO: ISSO APAGAR√Å TUDO NO SERVIDOR!")) {
                set(ref(db), { estandes: {}, marcenarias: {} });
            }
        };

        window.fecharModal = () => {
            els.modal.classList.add('hidden');
            estandeSelecionado = null;
        };

        window.exportarXLS = () => {
            let csv = '\uFEFFEstande;Produtor;Marcenaria;Status\n'; 
            for (const [id, dados] of Object.entries(DADOS.estandes)) {
                csv += `${id};${dados.produtor};${dados.marcenaria};${dados.status}\n`;
            }
            const link = document.createElement("a");
            link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
            link.download = "Relatorio_Online.csv";
            link.click();
        };

        window.abrirModal = (poly) => {
            estandeSelecionado = poly;
            const nome = poly.getAttribute('data-nome');
            const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
            const dados = DADOS.estandes[idSeguro] || {};
            
            els.title.innerText = nome;
            els.produtor.value = dados.produtor || ''; 
            els.status.value = dados.status || 'nao_iniciado';

            // RECARREGA A LISTA DO SELECT ANTES DE DEFINIR O VALOR
            renderizarMarcenarias(); 
            els.marcenaria.value = dados.marcenaria || ''; 

            // Link Logic (Robust closest 'a')
            let link = null;
            let current = poly;
            // Sobe at√© 4 n√≠veis buscando <a>. Aumentei para 4 para garantir.
            for(let i=0; i<4; i++) {
                if (current.tagName === 'A' || current.tagName === 'a') {
                    // Tenta pegar href ou xlink:href (para compatibilidade com SVGs antigos)
                    link = current.getAttribute('href') || current.getAttribute('xlink:href');
                    break;
                }
                current = current.parentNode;
                if (!current) break;
            }

            if (link) {
                els.linkBtn.href = link;
                els.linkBtn.classList.remove('hidden');
                els.linkBtn.classList.add('flex');
            } else {
                els.linkBtn.classList.add('hidden');
                els.linkBtn.classList.remove('flex');
                els.linkBtn.href = '#'; // Reseta o link para evitar comportamentos estranhos
            }

            els.modal.classList.remove('hidden');
        };

        window.focarNoMapa = (nome) => {
            const el = document.querySelector(`[data-nome="${nome}"]`);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Pisca
                const originalFill = el.style.fill;
                el.style.fill = "#facc15"; 
                setTimeout(() => {
                    const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
                    const dados = DADOS.estandes[idSeguro] || {};
                    aplicarEstiloVisual(el, dados); 
                }, 1000);
                window.abrirModal(el);
            }
        };

        // --- SINCRONIZA√á√ÉO E RENDERIZA√á√ÉO ---
        onValue(ref(db), (snapshot) => {
            els.loading.style.display = 'none';
            const val = snapshot.val();
            DADOS = val || { estandes: {}, marcenarias: {} };
            if (!DADOS.estandes) DADOS.estandes = {};
            if (!DADOS.marcenarias) DADOS.marcenarias = {};

            renderizarMarcenarias();
            renderizarMapaETabela();
        });

        function renderizarMarcenarias() {
            els.marcenariaContainer.innerHTML = '';
            els.marcenaria.innerHTML = '<option value="">-- Sem Marcenaria --</option>';

            const lista = DADOS.marcenarias;
            if(Object.keys(lista).length === 0) {
                els.marcenariaContainer.innerHTML = '<p class="text-sm text-slate-400 italic">Nenhuma cadastrada.</p>';
            }

            for (const [nome, cor] of Object.entries(lista)) {
                // UI
                els.marcenariaContainer.innerHTML += `
                    <div class="flex items-center gap-2 bg-slate-50 border border-slate-200 px-3 py-1 rounded-full text-xs font-bold text-slate-600 shrink-0">
                        <div class="w-4 h-4 rounded-full border border-slate-300" style="background-color: ${cor}"></div>
                        ${nome}
                        <button class="text-red-400 hover:text-red-600 ml-1 font-bold" onclick="window.removerMarcenaria('${nome}')">√ó</button>
                    </div>`;
                
                // Select Option
                const opt = document.createElement('option');
                opt.value = nome;
                opt.textContent = nome;
                els.marcenaria.appendChild(opt);
            }
        }

        function renderizarMapaETabela() {
            let total = 0, concluidos = 0;
            els.tableBody.innerHTML = '';

            document.querySelectorAll('.estande').forEach(poly => {
                const nome = poly.getAttribute('data-nome');
                const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
                const dados = DADOS.estandes[idSeguro] || { produtor: '', marcenaria: '', status: 'nao_iniciado' };
                
                // Visual
                aplicarEstiloVisual(poly, dados);

                // Tabela
                total++;
                if(dados.status === 'construido') concluidos++;

                let badgeClass = 'bg-slate-100 text-slate-500 border-slate-200';
                let badgeText = 'N√£o Iniciado';
                if (dados.status === 'construido') { badgeClass = 'bg-green-100 text-green-700 border-green-200'; badgeText = 'Pronto'; }
                else if (dados.status === 'em_construcao') { badgeClass = 'bg-orange-100 text-orange-700 border-orange-200'; badgeText = 'Obras'; }

                const corHex = (dados.marcenaria && DADOS.marcenarias[dados.marcenaria]) || '#cbd5e1';
                
                const tr = document.createElement('tr');
                tr.className = "hover:bg-blue-50 transition cursor-pointer group border-b border-slate-50";
                tr.innerHTML = `
                    <td class="p-4 font-bold text-slate-700 whitespace-nowrap">${nome}</td>
                    <td class="p-4 text-slate-500">${dados.produtor || '-'}</td>
                    <td class="p-4 text-slate-600 flex items-center">
                        <span class="inline-block w-3 h-3 rounded-full mr-2 shadow-sm" style="background:${corHex}"></span>
                        ${dados.marcenaria || '-'}
                    </td>
                    <td class="p-4 text-center"><span class="px-3 py-1 rounded-full text-[10px] font-black uppercase border ${badgeClass}">${badgeText}</span></td>
                    <td class="p-4 text-right"><span class="text-blue-600 text-xs font-bold uppercase opacity-0 group-hover:opacity-100 cursor-pointer" onclick="window.focarNoMapa('${nome}')">Editar</span></td>
                `;
                els.tableBody.appendChild(tr);
            });

            // Progresso
            const p = total > 0 ? Math.round((concluidos / total) * 100) : 0;
            els.progress.style.width = p + '%';
            els.progressText.innerText = p + '%';
            
            filtrarBusca(els.search.value);
        }

        function aplicarEstiloVisual(poly, dados) {
            poly.classList.remove('status-construido', 'status-em_construcao', 'status-nao_iniciado');
            poly.classList.add(dados.status ? `status-${dados.status}` : 'status-nao_iniciado');

            const cor = (dados.marcenaria && DADOS.marcenarias[dados.marcenaria]);
            poly.style.fill = cor || "";
            poly.style.fillOpacity = cor ? "0.6" : "";
        }

        function filtrarBusca(t) {
            t = t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            document.querySelectorAll('.estande').forEach(poly => {
                const nome = poly.getAttribute('data-nome');
                const idSeguro = nome.replace(/[.#$[\]\/]/g, "_");
                const dados = DADOS.estandes[idSeguro] || {};
                const text = `${nome} ${dados.produtor || ''} ${dados.marcenaria || ''}`.toLowerCase();
                
                if (t === "") {
                    poly.classList.remove('estande-dimmed', 'estande-match');
                } else if (text.includes(t)) {
                    poly.classList.add('estande-match');
                    poly.classList.remove('estande-dimmed');
                } else {
                    poly.classList.add('estande-dimmed');
                    poly.classList.remove('estande-match');
                }
            });
            Array.from(els.tableBody.rows).forEach(tr => {
                const text = tr.innerText.toLowerCase();
                tr.style.display = text.includes(t) ? '' : 'none';
            });
        }

        // --- INIT ---
        document.querySelectorAll('.estande').forEach(poly => {
            const title = poly.querySelector('title');
            if(title) poly.setAttribute('data-nome', title.textContent.trim());
            
            poly.onclick = (e) => {
                e.preventDefault(); 
                e.stopPropagation();
                window.abrirModal(poly);
            };
        });
        
        els.search.addEventListener('input', (e) => filtrarBusca(e.target.value));

    </script>
</body>
</html>