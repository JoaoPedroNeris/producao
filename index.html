<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gest√£o FEIRA DA INDUSTRIA 2026</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }

        /* --- MAPA --- */
        .estande { 
            fill: rgba(255, 255, 255, 0.5); 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            stroke: #94a3b8; 
            stroke-width: 1px; 
            pointer-events: auto; 
        }
        .estande:hover { 
            stroke-width: 5px !important; 
            stroke: #3b82f6 !important; 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15)); 
            z-index: 100; 
            fill: rgba(255, 255, 255, 0.8);
        }
        
        /* STATUS CORES */
        .status-nao_iniciado { stroke: #cbd5e1 !important; fill: rgba(241, 245, 249, 0.5); }
        .status-em_construcao { stroke: #f59e0b !important; stroke-width: 3px; stroke-dasharray: 6,4; fill: rgba(254, 243, 199, 0.5); } 
        .status-construido { stroke: #3b82f6 !important; stroke-width: 3px; fill: rgba(219, 234, 254, 0.5); } 
        .status-concluido { stroke: #10b981 !important; stroke-width: 2px; fill: rgba(209, 250, 229, 0.85); z-index: 10; } 
        .status-atrasado { stroke: #ef4444 !important; stroke-width: 4px; animation: pulse 2s infinite; }
        
        .estande-match { stroke: #1e293b !important; stroke-width: 6px !important; z-index: 50; fill-opacity: 0.9 !important; }
        .estande-dimmed { opacity: 0.1; transition: opacity 0.3s ease; }
        @keyframes pulse { 0% { stroke-opacity: 1; } 50% { stroke-opacity: 0.4; } 100% { stroke-opacity: 1; } }

        /* LOADING & MODAL */
        #loading { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 1rem; backdrop-filter: blur(4px); }
        .anim-modal { animation: modalFadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        /* ACESSO */
        body:not(.is-admin) .admin-only { display: none !important; }
        body:not(.is-admin) .editable-input { pointer-events: none; background-color: #f8fafc; border-color: transparent; color: #64748b; }
        body:not(.is-admin) input[type="checkbox"] { pointer-events: none; opacity: 0.7; }
        
        .map-scroll-container { overflow: auto; -webkit-overflow-scrolling: touch; border: 1px solid #e2e8f0; border-radius: 1rem; background: white; position: relative; max-height: 70vh; box-shadow: inset 0 0 20px rgba(0,0,0,0.03); }
        #tooltip { position: absolute; background: rgba(30, 41, 59, 0.95); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; pointer-events: none; z-index: 2000; display: none; white-space: nowrap; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255,255,255,0.1); }

        /* ABAS & GALERIA */
        .tab-btn { padding: 12px; border-bottom: 2px solid transparent; color: #64748b; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.75rem; letter-spacing: 0.05em; }
        .tab-btn:hover { color: #3b82f6; background-color: #f8fafc; }
        .tab-btn.active { border-bottom-color: #3b82f6; color: #3b82f6; background-color: white; }
        .tab-content { display: none; animation: fadeIn 0.2s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .gallery-item { position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; cursor: pointer; border: 1px solid #e2e8f0; transition: transform 0.2s; }
        .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .btn-remove-img { position: absolute; top: 6px; right: 6px; background: rgba(239, 68, 68, 0.9); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; transition: background 0.2s; }
        .btn-remove-img:hover { background: #dc2626; }
    </style>
</head>
<body class="text-slate-800 pb-24">

    <div id="tooltip"></div>
    
    <div id="loading">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center text-blue-600 text-xl"><i class="fa-solid fa-industry"></i></div>
        </div>
        <span class="font-semibold text-slate-500 mt-4 text-sm tracking-wide animate-pulse">CARREGANDO SISTEMA...</span>
    </div>

    <div id="login-modal" class="modal-overlay" style="z-index: 10000;">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center relative anim-modal border border-slate-100">
            <button id="btn-close-login" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-xl transition"><i class="fa-solid fa-times"></i></button>
            <div class="mb-6 inline-flex p-4 rounded-full bg-blue-50 text-blue-600 text-3xl shadow-sm"><i class="fa-solid fa-user-shield"></i></div>
            <h1 class="text-2xl font-bold text-slate-800 mb-1">Acesso Restrito</h1>
            <p class="text-xs text-slate-500 mb-6 font-medium">Gest√£o T√©cnica - Feira 2026</p>
            <div class="space-y-3">
                <div class="relative">
                    <i class="fa-solid fa-envelope absolute left-3 top-3.5 text-slate-400 text-sm"></i>
                    <input type="email" id="login-email" placeholder="Email Corporativo" class="w-full pl-9 border border-slate-200 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-3 top-3.5 text-slate-400 text-sm"></i>
                    <input type="password" id="login-pass" placeholder="Senha de Acesso" class="w-full pl-9 border border-slate-200 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition">
                </div>
            </div>
            <button id="btn-do-login" class="w-full mt-6 bg-blue-600 text-white font-bold py-3.5 rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-200 text-sm tracking-wide">ENTRAR NO SISTEMA</button>
            <p id="login-error" class="text-red-500 text-xs mt-4 hidden font-bold bg-red-50 p-2.5 rounded-lg border border-red-100 flex items-center justify-center gap-2"><i class="fa-solid fa-circle-exclamation"></i> <span>Dados incorretos.</span></p>
        </div>
    </div>

    <div id="modal-estande" class="modal-overlay">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[95vh] anim-modal border border-slate-200/60">
            <div class="bg-slate-900 p-5 text-white flex justify-between items-center shrink-0 shadow-md relative z-20">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center font-bold text-lg backdrop-blur-sm border border-white/10 shadow-inner"><i class="fa-solid fa-store"></i></div>
                    <div>
                        <span class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Gerenciamento</span>
                        <h3 id="modal-title" class="text-lg font-bold tracking-tight truncate max-w-[220px]">Estande #00</h3>
                    </div>
                </div>
                <button id="btn-close-modal" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition text-slate-300 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>

            <div class="flex border-b border-slate-200 px-6 bg-white sticky top-0 z-10 shadow-sm">
                <button class="tab-btn active flex-1 text-xs" data-tab="tab-dados"><i class="fa-solid fa-circle-info mr-1.5"></i> DADOS</button>
                <button class="tab-btn flex-1 text-xs" data-tab="tab-check"><i class="fa-solid fa-list-check mr-1.5"></i> CHECKLIST</button>
                <button class="tab-btn flex-1 text-xs" data-tab="tab-galeria"><i class="fa-solid fa-images mr-1.5"></i> FOTOS</button>
            </div>
            
            <div class="p-6 overflow-y-auto bg-slate-50/50 flex-1">
                <div id="tab-dados" class="tab-content active space-y-5">
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                        <div class="flex justify-between items-center mb-3">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Status Atual</label>
                            <span id="badge-status-modal" class="px-2.5 py-1 rounded-md text-[10px] font-bold bg-slate-100 text-slate-600 uppercase border border-slate-200">...</span>
                        </div>
                        <div class="relative">
                            <select id="sel-status" class="editable-input w-full border border-slate-200 rounded-xl p-3 text-sm font-semibold bg-slate-50 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition appearance-none">
                                <option value="nao_iniciado">‚ö™ N√£o Iniciado</option>
                                <option value="em_construcao">üöß Em Constru√ß√£o</option>
                                <option value="construido">üèóÔ∏è Constru√≠do (Fase Final)</option>
                                <option value="concluido">‚úÖ Conclu√≠do (Entregue)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400 text-xs"><i class="fa-solid fa-chevron-down"></i></div>
                        </div>
                        <button id="btn-quick-finish" class="admin-only w-full mt-3 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold text-xs uppercase shadow-md transition flex items-center justify-center gap-2 transform active:scale-[0.98]"><i class="fa-solid fa-check-circle"></i> Marcar Conclu√≠do</button>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1.5">Produtor</label>
                            <input type="text" id="inp-produtor" class="editable-input w-full border border-slate-200 bg-white rounded-xl p-2.5 text-sm font-semibold text-slate-700 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1.5">Entrega</label>
                            <input type="date" id="inp-data" class="editable-input w-full border border-slate-200 bg-white rounded-xl p-2.5 text-sm font-semibold text-slate-700 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition">
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1.5">Equipe de Montagem</label>
                        <div class="relative">
                            <select id="sel-marcenaria" class="editable-input w-full border border-slate-200 bg-white rounded-xl p-2.5 text-xs font-bold outline-none focus:border-blue-500 appearance-none">
                                <option value="">-- Selecione --</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400 text-xs"><i class="fa-solid fa-chevron-down"></i></div>
                        </div>
                    </div>
                    
                    <div class="admin-only">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1.5">Link Drive Externo</label>
                        <input type="text" id="inp-link" placeholder="Cole o link aqui..." class="w-full border border-slate-200 bg-white rounded-xl p-2.5 text-xs text-slate-600 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition placeholder-slate-300">
                    </div>
                    
                    <a id="btn-drive-action" href="#" target="_blank" class="hidden flex items-center justify-center gap-2 w-full py-3 bg-white text-blue-600 rounded-xl border border-blue-100 font-bold text-xs uppercase hover:bg-blue-50 hover:border-blue-200 transition shadow-sm group">
                        <i class="fa-brands fa-google-drive text-lg group-hover:scale-110 transition-transform"></i> ACESSAR PASTA DRIVE
                    </a>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1.5">Observa√ß√µes</label>
                        <textarea id="inp-obs" rows="3" class="editable-input w-full border border-slate-200 bg-white rounded-xl p-3 text-sm text-slate-700 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition placeholder-slate-300 resize-none" placeholder="Nenhuma observa√ß√£o registrada."></textarea>
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button id="btn-whatsapp" class="flex-1 py-2.5 bg-green-500 text-white rounded-xl font-bold text-xs hover:bg-green-600 transition shadow-sm flex items-center justify-center gap-2"><i class="fa-brands fa-whatsapp text-sm"></i> Relat√≥rio</button>
                        <button id="btn-pdf" class="flex-1 py-2.5 bg-slate-700 text-white rounded-xl font-bold text-xs hover:bg-slate-800 transition shadow-sm flex items-center justify-center gap-2"><i class="fa-solid fa-file-pdf"></i> PDF</button>
                    </div>
                </div>

                <div id="tab-check" class="tab-content space-y-4">
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                        <h4 class="text-xs font-black text-slate-400 uppercase mb-4 border-b border-slate-50 pb-2 flex items-center gap-2"><i class="fa-solid fa-tasks"></i> Itens de Entrega</h4>
                        <div class="space-y-3">
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 transition" value="piso"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">Piso / Carpete / Tablado</span></label>
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300" value="eletrica"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">El√©trica / Ilumina√ß√£o</span></label>
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300" value="mobiliario"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">Mobili√°rio / Balc√µes</span></label>
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300" value="logotipia"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">Logotipia / Adesivos</span></label>
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300" value="visual"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">Comunica√ß√£o Visual Geral</span></label>
                            <label class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-slate-200 transition group"><input type="checkbox" class="chk-task accent-blue-600 w-5 h-5 rounded border-gray-300" value="limpeza"><span class="text-sm font-semibold text-slate-600 group-hover:text-slate-800 transition">Limpeza Final / Retirada Lixo</span></label>
                        </div>
                    </div>
                </div>

                <div id="tab-galeria" class="tab-content space-y-4">
                    <div class="admin-only mb-4">
                        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-blue-200 rounded-2xl cursor-pointer bg-blue-50/50 hover:bg-blue-50 hover:border-blue-400 transition group">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6"><i class="fa-solid fa-camera text-3xl text-blue-400 group-hover:text-blue-600 mb-2 transition"></i><p class="text-xs text-blue-500 font-bold group-hover:text-blue-700">Adicionar Foto (C√¢mera/Arquivo)</p></div>
                            <input id="input-photo-upload" type="file" class="hidden" accept="image/*" multiple>
                        </label>
                    </div>
                    <div id="gallery-container" class="gallery-grid"></div>
                    <div id="img-preview-container" class="hidden rounded-xl overflow-hidden border border-slate-200 h-48 bg-slate-100 relative mb-4 shadow-sm group">
                        <img id="img-preview" src="" class="w-full h-full object-cover">
                        <a id="btn-view-photo" href="#" target="_blank" class="absolute inset-0 flex items-center justify-center bg-slate-900/60 text-white font-bold opacity-0 group-hover:opacity-100 transition backdrop-blur-sm"><i class="fa-solid fa-expand mr-2"></i> Ver Original</a>
                    </div>
                    <div id="no-photos-msg" class="flex flex-col items-center justify-center py-10 text-slate-300">
                        <i class="fa-regular fa-images text-4xl mb-2"></i>
                        <p class="text-xs italic">Nenhuma foto registrada.</p>
                    </div>
                </div>
            </div>

            <div class="p-5 bg-white border-t border-slate-100 flex justify-between items-center admin-only shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] relative z-20">
                <button id="btn-delete" class="text-red-500 hover:text-red-700 text-xs font-bold px-4 py-2.5 rounded-lg hover:bg-red-50 transition border border-transparent hover:border-red-100 flex items-center gap-2"><i class="fa-solid fa-trash"></i> Excluir</button>
                <button id="btn-save" class="bg-slate-900 hover:bg-black text-white px-8 py-3 rounded-xl font-bold text-xs shadow-lg shadow-slate-200 transform active:scale-95 transition flex items-center gap-2"><i class="fa-solid fa-save"></i> SALVAR TUDO</button>
            </div>
            
            <div id="msg-visitante" class="p-4 bg-slate-50 border-t border-slate-200 text-center text-xs text-slate-500 italic flex items-center justify-center gap-2">
                <i class="fa-solid fa-lock text-slate-400"></i> Modo visualiza√ß√£o. Fa√ßa login para editar.
            </div>
        </div>
    </div>

    <div id="app-container" class="w-full px-4 md:px-8 pb-12 space-y-8 hidden max-w-7xl mx-auto pt-6">
        
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-50 rounded-full blur-3xl opacity-50 -mr-20 -mt-20 pointer-events-none"></div>
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative z-10">
                <div class="flex items-center gap-4">
                    <div class="bg-slate-900 text-white w-12 h-12 flex items-center justify-center rounded-xl shadow-lg shadow-slate-200"><i class="fa-solid fa-industry text-xl"></i></div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-black text-slate-800 uppercase italic tracking-tighter leading-tight">FEIRA DA IND√öSTRIA <span class="text-blue-600">2026</span></h1>
                        <div class="flex items-center gap-3 mt-1">
                            <span id="badge-user" class="text-[10px] bg-slate-100 text-slate-500 px-2.5 py-0.5 rounded-full border border-slate-200 font-bold uppercase tracking-wide">VISITANTE</span>
                            <span class="text-[10px] text-slate-400 font-medium flex items-center gap-1"><i class="fa-regular fa-clock"></i> <span id="last-update">Atualizado agora</span></span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 w-full md:w-auto">
                    <button id="btn-open-login" class="flex-1 md:flex-none px-6 py-2.5 bg-blue-600 text-white rounded-full text-xs font-bold hover:bg-blue-700 transition shadow-md shadow-blue-100 flex items-center justify-center gap-2"><i class="fa-solid fa-right-to-bracket"></i> Login Admin</button>
                    <button id="btn-logout" class="hidden flex-1 md:flex-none px-6 py-2.5 bg-white text-slate-600 rounded-full text-xs font-bold hover:bg-slate-50 border border-slate-200 transition flex items-center justify-center gap-2"><i class="fa-solid fa-right-from-bracket"></i> Sair</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 relative z-10">
                <div class="bg-white border border-slate-100 rounded-2xl p-5 flex items-center justify-between relative overflow-hidden shadow-sm hover:shadow-md transition group">
                    <div class="w-32 h-32 relative">
                        <canvas id="chart-status"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center flex-col pointer-events-none">
                            <span class="text-[9px] text-slate-400 font-bold uppercase tracking-wider">TOTAL</span>
                            <span id="dash-total-big" class="text-2xl font-black text-slate-800 -mt-1">0</span>
                        </div>
                    </div>
                    <div class="flex-1 pl-6 space-y-2">
                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest border-b border-slate-50 pb-1 mb-1">Status Geral</div>
                        <p class="text-xs flex justify-between items-center text-slate-600 font-medium"><span><i class="fa-solid fa-circle text-green-500 text-[6px] mr-1"></i> Conclu√≠do</span> <strong id="dash-concluido" class="text-slate-800 bg-green-50 px-1.5 rounded">0</strong></p>
                        <p class="text-xs flex justify-between items-center text-slate-600 font-medium"><span><i class="fa-solid fa-circle text-blue-500 text-[6px] mr-1"></i> Constru√≠do</span> <strong id="dash-construido" class="text-slate-800 bg-blue-50 px-1.5 rounded">0</strong></p>
                        <p class="text-xs flex justify-between items-center text-slate-600 font-medium"><span><i class="fa-solid fa-circle text-orange-500 text-[6px] mr-1"></i> Em Obra</span> <strong id="dash-obra" class="text-slate-800 bg-orange-50 px-1.5 rounded">0</strong></p>
                        <p class="text-xs flex justify-between items-center text-slate-600 font-medium"><span><i class="fa-solid fa-circle text-slate-300 text-[6px] mr-1"></i> N/I</span> <strong id="dash-ni" class="text-slate-800 bg-slate-50 px-1.5 rounded">0</strong></p>
                    </div>
                </div>

                <div class="bg-white border border-slate-100 rounded-2xl p-5 shadow-sm hover:shadow-md transition flex flex-col justify-center lg:col-span-2 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-red-50 rounded-full blur-3xl opacity-40 -mr-10 -mt-10 pointer-events-none"></div>
                    <div class="flex justify-between items-center mb-4 relative z-10">
                        <h4 class="text-xs font-black text-slate-400 uppercase tracking-wider"><i class="fa-solid fa-list-check mr-1.5"></i> Pend√™ncias (Checklist)</h4>
                        <span id="total-pendencias" class="text-[10px] bg-red-100 text-red-600 px-2.5 py-1 rounded-full font-bold shadow-sm">0 itens</span>
                    </div>
                    <div class="w-full h-32 relative z-10">
                        <canvas id="chart-pendencias"></canvas>
                    </div>
                </div>
            </div>

            <div class="relative group z-10">
                <div class="bg-slate-50/80 backdrop-blur rounded-2xl border border-slate-200 flex items-center p-1.5 group-focus-within:bg-white group-focus-within:border-blue-400 group-focus-within:ring-4 group-focus-within:ring-blue-50 transition-all shadow-sm">
                    <span class="pl-4 text-slate-400 group-focus-within:text-blue-500 transition"><i class="fa-solid fa-search"></i></span>
                    <input type="text" id="search-input" placeholder="Buscar por estande, produtor, equipe ou status..." class="w-full p-3 bg-transparent outline-none text-slate-700 font-bold text-sm placeholder-slate-400">
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="space-y-6">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 sticky top-24">
                    <h3 class="text-xs font-black text-slate-400 uppercase mb-4 tracking-wider">Filtros R√°pidos</h3>
                    <div class="space-y-2">
                        <button id="flt-todos" class="w-full text-left px-4 py-2.5 bg-slate-50 hover:bg-slate-100 rounded-xl text-xs font-bold text-slate-600 transition border border-transparent hover:border-slate-200 flex items-center gap-2"><i class="fa-regular fa-eye"></i> Todos</button>
                        <button id="flt-sem-drive" class="w-full text-left px-4 py-2.5 bg-purple-50 hover:bg-purple-100 rounded-xl text-xs font-bold text-purple-600 border border-transparent hover:border-purple-200 transition flex items-center gap-2"><i class="fa-regular fa-folder-open"></i> Sem Drive/Foto</button>
                        <button id="flt-atrasados" class="w-full text-left px-4 py-2.5 bg-red-50 hover:bg-red-100 rounded-xl text-xs font-bold text-red-600 border border-transparent hover:border-red-200 transition flex items-center gap-2"><i class="fa-solid fa-triangle-exclamation"></i> Atrasados</button>
                        <button id="flt-obras" class="w-full text-left px-4 py-2.5 bg-orange-50 hover:bg-orange-100 rounded-xl text-xs font-bold text-orange-600 border border-transparent hover:border-orange-200 transition flex items-center gap-2"><i class="fa-solid fa-hammer"></i> Em Obras</button>
                        <button id="flt-prontos" class="w-full text-left px-4 py-2.5 bg-green-50 hover:bg-green-100 rounded-xl text-xs font-bold text-green-600 border border-transparent hover:border-green-200 transition flex items-center gap-2"><i class="fa-solid fa-check"></i> Conclu√≠dos</button>
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-100 admin-only">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3 tracking-wider">Gerir Equipes</h3>
                        <div class="flex gap-2 mb-3">
                            <input type="text" id="new-marcenaria-name" placeholder="Nome" class="flex-1 border border-slate-200 rounded-lg px-3 text-xs bg-slate-50 outline-none focus:border-blue-400">
                            <input type="color" id="new-marcenaria-color" value="#2563eb" class="h-8 w-8 rounded cursor-pointer border-0 p-0 shadow-sm">
                            <button id="btn-add-marcenaria" class="px-3 bg-slate-800 text-white rounded-lg text-xs font-bold hover:bg-black transition shadow-sm"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div id="list-marcenarias" class="flex flex-wrap gap-2"></div>
                    </div>

                    <div class="mt-6 pt-6 border-t border-slate-100">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3 tracking-wider">A√ß√µes</h3>
                        <button id="btn-export-xls" class="w-full py-2.5 bg-green-600 text-white text-xs font-bold rounded-xl hover:bg-green-700 mb-2 transition shadow-sm shadow-green-200 flex items-center justify-center gap-2"><i class="fa-solid fa-file-excel"></i> Baixar Relat√≥rio</button>
                        <button id="btn-reset-db" class="w-full py-2.5 bg-white border border-red-100 text-red-500 text-xs font-bold rounded-xl hover:bg-red-50 transition admin-only flex items-center justify-center gap-2"><i class="fa-solid fa-bomb"></i> Resetar Dados</button>
                    </div>
                </div>
            </div>

            <div class="md:col-span-3 space-y-8">
                
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden group hover:shadow-md transition">
                    <div class="bg-slate-50 p-3 px-5 border-b border-slate-200 flex justify-between items-center">
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-600 flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-blue-500"></div> Pavilh√£o Leste</span>
                        <i class="fa-solid fa-map text-slate-300 group-hover:text-blue-400 transition"></i>
                    </div>
                    <div class="map-scroll-container">
                        <div class="min-w-[1000px] md:min-w-full relative">
                            <img src="PB-FEIRA DA INDUSTRIA-2025-REV 36-ESPA√áO LIVRE X OCUPADOS (1)_pages-to-jpg-0002.jpg" class="w-full h-auto block opacity-40 pointer-events-none relative z-0 grayscale-[30%]">
                            <svg viewBox="0 0 4963 3509" class="absolute top-0 left-0 w-full h-full z-10 drop-shadow-sm" xmlns="http://www.w3.org/2000/svg">
                                <polygon class="estande" points="903,1596 982,1622 1048,1478 973,1443"><title>Pena 02 03</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1UQl3ZFZRBQuzyzdNShfngPbshaTr7Z8G?usp=sharing"><polygon class="estande" points="1122,1378 991,1391 969,1439 1148,1514"><title>Grendene 04</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="1048,1483 1144,1518 1166,1628 1100,1676 986,1628"><title>IEL 05</title></polygon></a>
                                <polygon class="estande" points="925,1650 1078,1720 1091,1825 965,1930"><title>Beatriz Textil 01</title></polygon>
                                <polygon class="estande" points="1087,2114 1223,1991 1205,1886 1126,1851 965,1991"><title>SindRoupas 34 36 37</title></polygon>
                                <polygon class="estande" points="1175,1369 1302,1347 1450,1514 1288,1649 1210,1614"><title>Grupo Argo 06 07 08 09</title></polygon>
                                <polygon class="estande" points="1319,1682 1411,1599 1494,1678 1337,1708"><title>RevaMond 19</title></polygon>
                                <polygon class="estande" points="1481,1544 1420,1601 1494,1684 1590,1667"><title>Atelie Silvana de deus 18</title></polygon>
                                <a href="https://drive.google.com/drive/folders/12lZF_uPdwf4sZX9Qu2s0_hTUDcOpa75u?usp=sharing"><polygon class="estande" points="1498,1734 1455,1835 1332,1778 1341,1752"><title>Tramix 21</title></polygon></a>
                                <polygon class="estande" points="1590,1715 1529,1872 1455,1833 1494,1728"><title>Boa kostura 20</title></polygon>
                                <polygon class="estande" points="1253,1871 1319,1827 1433,1880 1367,2028 1266,1985"><title>Handara 33</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1DyzPGIUn9HqxcIJ1UxacX3SEjSbj_BcQ?usp=sharing"><polygon class="estande" points="1332,2118 1372,2030 1442,2061 1420,2114"><title>Asa sul 32A</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/16uooWZJDPPS4YeV6f7AzkMfp7ye-Lpbc?usp=sharing"><polygon class="estande" points="1481,1471 1542,1423 1494,1370 1428,1414"><title>Sindcalf 10</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1jPl_Lc3feJLqnRpsG890Qt4NsQKmpUd0?usp=sharing"><polygon class="estande" points="1573,1451 1630,1525 1568,1573 1512,1512"><title>Revid 16</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1IPsS2jkrnP79HKwaMsDP7P5Cx3IMgBVr?usp=sharing"><polygon class="estande" points="1634,1517 1739,1644 1639,1657 1568,1570"><title>Fortmix 15</title></polygon></a>
                                <polygon class="estande" points="1582,1458 1735,1642 1796,1589 1770,1432 1700,1349"><title>Sesi/Senai Moda 13 14 17</title></polygon>
                                <a href="https://drive.google.com/drive/folders/12f7NIkhxXRLEg7KEEl04tKlX22_eAey1?usp=sharing"><polygon class="estande" points="1744,1694 1814,1724 1849,1882 1827,1917 1687,1838"><title>Sindi Industria 25</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/11zG1mxlgR3bFdGbx5ZS23J_ON4Qw2eT-?usp=sharing"><polygon class="estande" points="1761,1878 1831,1904 1800,1983 1726,1952"><title>Clipper 26</title></polygon></a>
                                <polygon class="estande" points="1962,1270 1709,1279 1796,1384 1905,1379"><title>Sesi/senai Leste</title></polygon>
                                <polygon class="estande" points="2216,1260 2151,1383 2011,1291 2024,1260"><title>Apodi</title></polygon>
                                <polygon class="estande" points="2085,1628 1989,1628 1923,1584 1923,1422 1984,1330 2190,1462"><title>Sinduscon 10 11 12 13 14</title></polygon>
                                <polygon class="estande" points="1945,1900 1923,1870 1923,1721 1993,1677 2076,1817"><title>`Rejuntamix 53</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1TZmzhWBf67cjniQvaZ1I7FphRH-pJcEi?usp=sharing"><polygon class="estande" points="2146,1930 2225,2035 2024,2044 2015,2013"><title>Sesi/Senai 49</title></polygon></a>
                                <polygon class="estande" points="2229,1491 2304,1539 2247,1626 2146,1626"><title>SindSerrais 09</title></polygon>
                                <a href="https://drive.google.com/drive/folders/16c7WvZqiqGC0AC1MZRRXzsdwahGMrjMx?usp=sharing"><polygon class="estande" points="2435,1747 2505,1778 2509,1891 2413,1953 2326,1808"><title>SindCeramica 43</title></polygon></a>
                                <polygon class="estande" points="2256,1441 2439,1568 2505,1524 2505,1266 2374,1262"><title>Sindmoveis 04 05 06 07</title></polygon>
                                <polygon class="estande" points="2558,1521 2632,1560 2798,1446 2689,1267 2558,1263"><title>Sindmoveis 15 16 17 18</title></polygon>
                                <polygon class="estande" points="2654,1600 2663,1626 2820,1626 2763,1535"><title>CNP 28</title></polygon>
                                <a href="https://drive.google.com/drive/folders/18R-1U8jAyyWI5grddvU8xkMJ7tFgT_Dk?usp=sharing"><polygon class="estande" points="2562,2035 2689,2039 2798,1851 2628,1742 2553,1781"><title>Simagram 39 40 41 42</title></polygon></a>
                                <polygon class="estande" points="2986,1485 3118,1402 3140,1420 3144,1582 3070,1625"><title>Romazi 25</title></polygon>
                                <polygon class="estande" points="2916,1773 3122,1908 3140,1882 3140,1716 3078,1672 2969,1676"><title>Sincompe 31 32</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1uIk3SdbL3yZ4zd3a_YAw0Su_p1EOv8Uk?usp=sharing"><polygon class="estande" points="2916,1922 3057,2014 3039,2040 2838,2036"><title>Sesi/Senai 36</title></polygon></a>
                                <polygon class="estande" points="3100,1264 3192,1426 3227,1430 3350,1282"><title>Sesi/Senai</title></polygon>
                                <polygon class="estande" points="3267,1589 3323,1641 3433,1519 3310,1414 3288,1444"><title>Acellormittal 11</title></polygon>
                                <a href="https://drive.google.com/drive/folders/10PY2vs8ird5Y927Oo7toCZt4lMApHJE9?usp=sharing"><polygon class="estande" points="3358,1347 3429,1408 3376,1465 3310,1408"><title>TotalDesign 12 </title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1a7vuUcSkchzVfbFDVjKNtDoVaf93z6J2?usp=sharing"><polygon class="estande" points="3367,1467 3490,1568 3547,1511 3424,1410"><title>Grupo 3G 13 14</title></polygon></a>
                                <polygon class="estande" points="3433,1515 3494,1568 3420,1660 3328,1642"><title>Br hidraulica 10</title></polygon>
                                <polygon class="estande" points="3240,1729 3315,1694 3420,1708 3490,1878 3262,1988 3218,1883"><title>Cemag 50 51 52 53 </title></polygon>
                                <polygon class="estande" points="3284,2026 3293,2056 3490,2083 3433,1960"><title>Central das correias 49</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1vCjWd1-pXA-5UB3m1lZ6DJX4izSsSAp1?usp=sharing"><polygon class="estande" points="3507,1924 3542,2003 3464,2034 3433,1964"><title>Durametal 47</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1rLUlZgqV128MFbqO8PB3AZrzwJMn5z-l?usp=sharing"><polygon class="estande" points="3542,2010 3586,2106 3499,2088 3468,2036"><title>Biomatika 48</title></polygon></a>
                                <polygon class="estande" points="3555,1913 3630,1874 3695,2027 3621,2058"><title>Sabao jau 45 46</title></polygon>
                                <polygon class="estande" points="3630,1880 3748,1827 3814,1875 3770,2129 3643,2107 3621,2063 3695,2024"><title>Sindquimica 43 44</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1tLn4jBVTrjQA536B11E9wHUqiWZ6oW5R?usp=sharing"><polygon class="estande" points="3730,1382 3787,1439 3730,1496 3674,1452"><title>Usb 05</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1rxf0llp24b-4ANL-8F8LwJ4YD-XPP7M8?usp=sharing"><polygon class="estande" points="3735,1503 3678,1564 3621,1512 3674,1450"><title>Simec 04</title></polygon></a>
                                <polygon class="estande" points="3787,1447 3871,1512 3853,1617 3774,1648 3678,1561"><title>Aco cearense 07</title></polygon>
                                <polygon class="estande" points="4120,1515 4050,1550 4015,1476 4085,1441"><title>Sindcarnauba 16</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1jtXiPqMYBUCybcg6nG3H6II3sLCWgy6R?usp=sharing"><polygon class="estande" points="4124,1524 4159,1594 4081,1629 4046,1554"><title>Conexao brindes 17</title></polygon></a>
                                <polygon class="estande" points="3984,1719 3989,1749 4238,1784 4173,1635"><title>Sesi/senai Metalmecanica</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1OuUG2nJsENEqoF9-Yu2j_-HJ4Ea3uh5V?usp=sharing"><polygon class="estande" points="4142,1825 4063,1903 3967,1816 3980,1794"><title>Netonda 29 </title></polygon></a>
                                <polygon class="estande" points="3936,1859 3862,1881 3840,1990 3923,2060 4032,1942"><title>Projeart 42</title></polygon>
                                <polygon class="estande" points="4093,1996 3953,2162 3818,2140 3848,1996 3927,2066 4036,1944"><title>Sindquimica 39 40 41</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1X4iZy0bn3fQ7xidVwRukQr6Hfh0Z6p73?usp=sharing"><polygon class="estande" points="4129,2029 4194,2086 4138,2143 4076,2086"><title>NobreTc 38</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/18biu6rWqxItznCAX4jgQxIA2EcGHJ04_?usp=sharing"><polygon class="estande" points="4291,1587 4326,1662 4256,1692 4221,1618"><title>Sankhya 22</title></polygon></a>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden group hover:shadow-md transition">
                    <div class="bg-slate-50 p-3 px-5 border-b border-slate-200 flex justify-between items-center">
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-600 flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-orange-500"></div> Pavilh√£o Oeste</span>
                        <i class="fa-solid fa-map text-slate-300 group-hover:text-orange-400 transition"></i>
                    </div>
                    <div class="map-scroll-container">
                        <div class="min-w-[1000px] md:min-w-full relative">
                            <img src="PB-FEIRA DA INDUSTRIA-2025-REV 36-ESPA√áO LIVRE X OCUPADOS (1)_pages-to-jpg-0003.jpg" class="w-full h-auto block opacity-40 pointer-events-none relative z-0 grayscale-[30%]">
                            <svg viewBox="0 0 4963 3509" class="absolute top-0 left-0 w-full h-full z-10 drop-shadow-sm" xmlns="http://www.w3.org/2000/svg">
                                <polygon class="estande" points="719,930 698,952 890,1122 1013,978"><title>Adece 02</title></polygon>
                                <a href="https://drive.google.com/drive/folders/14CHWr9btxvTlCGFCt9OkrJz49AFfKUdy?usp=sharing"><polygon class="estande" points="671,987 1052,1329 1043,1359 628,1294 562,1246 588,1079"><title>Fiec 01</title></polygon></a>
                                <polygon class="estande" points="1205,1008 1074,991 1004,1065 1175,1218"><title>Imprensa 03</title></polygon>
                                <polygon class="estande" points="1004,1066 1179,1215 1166,1267 1087,1298 930,1153"><title>CNI 04</title></polygon>
                                <polygon class="estande" points="549,1374 623,1339 719,1356 794,1544 566,1640 518,1540"><title>Sindicatos 21 22</title></polygon>
                                <polygon class="estande" points="588,1682 593,1717 890,1757 816,1586"><title>Sindicatos 20</title></polygon>
                                <polygon class="estande" points="776,1358 838,1516 1035,1432 1030,1402"><title>Arcepp 19</title></polygon>
                                <polygon class="estande" points="859,1561 912,1675 1122,1591 1122,1526 1056,1473"><title>Estudio de comunicacao 18</title></polygon>
                                <polygon class="estande" points="912,1677 951,1769 1083,1791 1113,1585"><title>BB 17</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="1389,1048 1258,1018 1214,1280 1280,1328 1477,1245"><title>IEL 05 06</title></polygon></a>
                                <polygon class="estande" points="1621,1451 1722,1469 1800,1429 1818,1267 1774,1167 1542,1267"><title>Sebrae 09 10</title></polygon>
                                <polygon class="estande" points="1450,1044 1744,1097 1757,1127 1525,1228 1529,1229"><title>Faculdades 08</title></polygon>
                                <polygon class="estande" points="1498,1289 1564,1442 1306,1402 1297,1372"><title>Sebrae 07</title></polygon>
                                <polygon class="estande" points="1372,1545 1428,1468 1297,1446 1284,1473 1358,1545 1428,1467"><title>Makro 14A</title></polygon>
                                <polygon class="estande" points="1555,1490 1446,1613 1363,1543 1428,1468"><title>Cegas 14</title></polygon>
                                <a href="https://drive.google.com/drive/folders/13CJ0MWXuu5z6B9iH6UYrRxRYpWK_QCEV?usp=sharing"><polygon class="estande" points="1253,1514 1175,1536 1135,1799 1266,1816 1411,1654"><title>Sesi/Senai 15 16</title></polygon></a>
                                <polygon class="estande" points="1617,1498 1709,1519 1787,1568 1748,1738 1555,1568"><title>BNB 11</title></polygon>
                                <polygon class="estande" points="1560,1564 1739,1726 1674,1813 1481,1647"><title>CEF 12</title></polygon>
                                <polygon class="estande" points="1621,1873 1643,1851 1450,1680 1323,1829"><title>13</title></polygon>
                                <polygon class="estande" points="1678,1878 1940,1900 1875,1790 1770,1782"><title>Sesi/Senai</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="1975,1161 1914,1253 1923,1419 1975,1467 2081,1467 2190,1301"><title>SindEnergia 10-14</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2002,1123 2019,1092 2317,1097 2216,1259"><title>SindEnergia 01 02 03</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2383,1096 2514,1091 2514,1363 2444,1402 2260,1288"><title>SindEnergia 04-07</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2229,1328 2413,1438 2404,1468 2142,1468"><title>SindEnergia 08 09</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1mXEGihwhcIXBPcWLVp0HvwInojREQO45?usp=sharing"><polygon class="estande" points="1984,1521 1914,1560 1914,1722 1932,1752 2072,1656"><title>Enel 53</title></polygon></a>
                                <polygon class="estande" points="1980,1521 2072,1657 2142,1617 2081,1512"><title>Startup-IST 54</title></polygon>
                                <a href="https://drive.google.com/drive/folders/14hEukvNMWbm0_7aKtskzdBrDxw5TehO9?usp=sharing"><polygon class="estande" points="1980,1825 2046,1773 1997,1707 1932,1742"><title>IMPTudo 52</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1HvGdeCHXN7BAjdTzeNhpa6WFZO9lfYtZ?usp=sharing"><polygon class="estande" points="2072,1664 2120,1729 2050,1769 2006,1703"><title>SindVerde 51</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1LByEgB03QnGcNFbd7zfVcx1Jj8lje4BT?usp=sharing"><polygon class="estande" points="2142,1618 2190,1684 2120,1727 2072,1657"><title>Idear 50</title></polygon></a>
                                <polygon class="estande" points="2002,1860 2019,1890 2312,1890 2216,1728"><title>Sesi/Senai Energia</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1q2Jnv2FjG-jeTYyH9IGUNuqFSiJHlG8j?usp=sharing"><polygon class="estande" points="2348,1839 2509,1734 2514,1887 2378,1891"><title>BigDooh Midia Ooh 44</title></polygon></a>
                                <polygon class="estande" points="2256,1695 2439,1585 2514,1625 2509,1734 2348,1835"><title>Qair 43 45 46</title></polygon>
                                <polygon class="estande" points="2142,1512 2234,1656 2413,1538 2400,1516"><title>Carmehill 08 09</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2562,1097 2702,1097 2816,1281 2632,1395 2562,1369"><title>SindEnergia 15 16 17 18</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2658,1445 2842,1327 2925,1467 2667,1467"><title>SindEnergia 27 28</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2829,1516 2776,1612 2663,1542 2671,1516"><title>SindEnergia 29</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2632,1580 2562,1624 2566,1733 2658,1799 2746,1654"><title>SindEnergia 42</title></polygon></a>
                                <polygon class="estande" points="2562,1740 2566,1889 2698,1889 2728,1845"><title>SindGrafica 41</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1vl2KuNI_FKjHKfUfJeeN6awIO0OzmNoF?usp=sharing"><polygon class="estande" points="2772,1763 2811,1697 2746,1658 2702,1723"><title>Cobamp 39</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1zkjfgkB1VXYFf0-ry08-IfuASeEGfZHV?usp=sharing"><polygon class="estande" points="2763,1776 2702,1724 2658,1794 2728,1842"><title>SindPneu 40</title></polygon></a>
                                <polygon class="estande" points="2833,1512 2930,1517 2846,1661 2772,1613"><title>EnergiaLightcom 30</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2860,1259 3070,1124 3052,1093 2755,1097"><title>SindEnergia 19 20 21</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uf1PV8YKzWhyUxpZxS4M48WuEz8szpfl?usp=sharing"><polygon class="estande" points="2886,1302 2991,1468 3092,1468 3000,1328 3144,1232 3096,1166"><title>SindEnergia 22 23 24 26</title></polygon></a>
                                <polygon class="estande" points="3004,1325 3140,1237 3157,1255 3162,1425 3092,1469"><title>Grupo Terlles 25</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1k86F3vThDPLEepa0Upi5xMz5YHBZR5EE?usp=sharing"><polygon class="estande" points="2986,1523 3092,1519 3000,1659 2930,1615"><title>Goodwe 31</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1Ct_Z1TrBGAw_1Viq6YPPG68H9y-4raZ9?usp=sharing"><polygon class="estande" points="2921,1617 3000,1661 2956,1726 2886,1682"><title>Lubtrol 35</title></polygon></a>
                                <polygon class="estande" points="3092,1520 3162,1564 3157,1638 3057,1577"><title>Dislub 32A</title></polygon>
                                <polygon class="estande" points="3052,1581 3030,1620 3000,1659 3148,1764 3157,1721 3157,1638"><title>Enie 32B</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1BRaXzC8t0zBRorUXLBBUr7fjaskTDOdh?usp=sharing"><polygon class="estande" points="3000,1663 3135,1751 3096,1825 2951,1729"><title>Energia Pecem 33 34</title></polygon></a>
                                <polygon class="estande" points="2811,1801 2881,1840 2930,1770 2855,1726"><title>38</title></polygon>
                                <polygon class="estande" points="2925,1773 3070,1861 3052,1891 2855,1887"><title>36</title></polygon>
                                <polygon class="estande" points="2807,1801 2759,1888 2860,1888 2877,1836"><title>37</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1gBICofXNIbF9BDwfMnTdomogbDHImKpR?usp=sharing"><polygon class="estande" points="3100,1897 3205,1735 3232,1735 3363,1880"><title>Sesi/Senai</title></polygon></a>
                                <polygon class="estande" points="3450,1194 3503,1063 3302,1094 3293,1124"><title>Frosty 01</title></polygon>
                                <polygon class="estande" points="3599,1053 3494,1061 3477,1114 3555,1140"><title>Itaueira 02</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1vGOjBJJoRe7V0OAu1ikf8XlsZcJzq8zC?usp=sharing"><polygon class="estande" points="3555,1149 3525,1219 3450,1188 3477,1114"><title>Milk 03</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1lRJ4vqJRuTxeziXn6yrP-bEx2wYtU-z2?usp=sharing"><polygon class="estande" points="3350,1201 3319,1279 3240,1249 3275,1170"><title>Alimempro ¬†12</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1FWE69FssQ4-Jgm8qgf4kPKv0FG5eHYoM?usp=sharing"><polygon class="estande" points="3411,1228 3389,1307 3315,1285 3350,1202"><title>Sindalimentos 13</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/13TG6Q2Yh65CK287jFVsZB8Gosveu57Ky?usp=sharing"><polygon class="estande" points="3420,1234 3503,1269 3464,1339 3389,1313"><title>Sindcafe 14</title></polygon></a>
                                <polygon class="estande" points="3389,1313 3328,1466 3253,1431 3227,1273 3236,1243"><title>Betania 11</title></polygon>
                                <polygon class="estande" points="3464,1346 3424,1447 3328,1460 3389,1316"><title>Diageo 10</title></polygon>
                                <polygon class="estande" points="3499,1704 3376,1809 3297,1726 3271,1564 3332,1512"><title>M dias 51 52 53</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1AFIQq15xBlxlTVMBIa8XV-r_NNwMAQIh?usp=sharing"><polygon class="estande" points="3424,1502 3503,1590 3446,1638 3332,1511"><title>Dikoko 54</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/14jCDtWXR3gZXYJ4565Yn5GhoETLguICz?usp=sharing"><polygon class="estande" points="3507,1587 3560,1648 3499,1705 3442,1639"><title>LDB 50</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1vr_rDkwHumjlmVPBZ1RtgXR2j9RS0e5P?usp=sharing"><polygon class="estande" points="3599,1686 3726,1831 3429,1874 3407,1848"><title>SindPan 47 48 49</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/144LcokE-liVFrgw6mlgvL9uZojTITzsY?usp=sharing"><polygon class="estande" points="3660,1040 3792,1018 3818,1167 3639,1088"><title>SindLacticinios ¬†04</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1T1ns61BOxmWCZB86Qd4_UNc95W0ukgGE?usp=sharing"><polygon class="estande" points="3630,1089 3713,1124 3674,1199 3604,1168"><title>Compex 07</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1aJim3BKnGbigVent_KEi9B2Ktm08GNrJ?usp=sharing"><polygon class="estande" points="3678,1202 3647,1267 3564,1246 3595,1176"><title>Especiarias da roca 06</title></polygon></a>
                                <polygon class="estande" points="3713,1125 3814,1173 3831,1278 3766,1331 3647,1274"><title>SindSorvetes 05</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1J4QiOmL4FLYlL7jgLuCCJdypwzQ6xFPN?usp=sharing"><polygon class="estande" points="3625,1321 3547,1286 3485,1444 3582,1422"><title>Fluido 09</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1PNMONo59ds69sxAc3jraDZYOypdAfycw?usp=sharing"><polygon class="estande" points="3625,1331 3744,1374 3739,1396 3582,1423"><title>Netumar 08</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1uWJ4kmmjzzd3yv3fBlvzp9PAyYJRrmXY?usp=sharing"><polygon class="estande" points="3604,1619 3660,1563 3586,1475 3494,1493 3564,1571"><title>Samaria 55</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/18sen-LQ1s_yb8rG3WFImeqEAhg0FPQIc?usp=sharing"><polygon class="estande" points="3752,1445 3761,1472 3660,1559 3586,1476"><title>Serra Grande 56</title></polygon></a>
                                <polygon class="estande" points="3700,1598 3752,1655 3687,1716 3630,1651"><title>Agromix 46</title></polygon>
                                <a href="https://drive.google.com/drive/folders/1OFcpges2pbJ8HGbxbAeMADgerDSQkr86?usp=sharing"><polygon class="estande" points="3796,1512 3875,1538 3888,1652 3809,1722 3695,1599"><title>J Macedo 43</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1zq-NvecShSaC7KrWPOdtof_SPzhFWhMr?usp=sharing"><polygon class="estande" points="3958,1296 3884,1274 3866,1160 3941,1086 4059,1213"><title>IEL 18 Oeste</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/181ORvZLpEE7IYgPKX5oVYxJghrJFLlzm?usp=sharing"><polygon class="estande" points="3989,1338 4006,1360 4159,1334 4089,1242"><title>Maria Pitanga 28</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1TO44cinqiLUHRBgFY-g9l-iFVgfkff2J?usp=sharing"><polygon class="estande" points="4155,1124 4221,1067 4159,1005 4098,1058"><title>Grupo Souza Miranda 21</title></polygon></a>
                                <polygon class="estande" points="3989,1479 3919,1532 3936,1632 4041,1680 4107,1527"><title>3 coracoes 42</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1gBICofXNIbF9BDwfMnTdomogbDHImKpR?usp=sharing"><polygon class="estande" points="4111,1543 4177,1565 4094,1766 3962,1783 3945,1639 4046,1683"><title>Sesi/Senai 39 40 41</title></polygon></a>
                                <a href="https://drive.google.com/drive/folders/1paJeqT_F1-lf33Rn-sxeqw211A-AVuzJ?usp=sharing"><polygon class="estande" points="4330,1580 4361,1501 4278,1462 4256,1536"><title>Puro acai 35</title></polygon></a>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                     <div class="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                        <h3 class="text-slate-600 text-xs font-black uppercase tracking-wider"><i class="fa-solid fa-table-list mr-2"></i> Detalhamento dos Estandes</h3>
                        <span class="text-[10px] text-slate-400 italic">Clique na linha para editar</span>
                    </div>
                    <div class="max-h-[500px] overflow-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-white sticky top-0 shadow-sm text-[10px] font-bold text-slate-400 uppercase tracking-wide z-10">
                                <tr>
                                    <th class="p-4 bg-slate-50/90 backdrop-blur">Estande</th>
                                    <th class="p-4 bg-slate-50/90 backdrop-blur">Produtor</th>
                                    <th class="p-4 bg-slate-50/90 backdrop-blur">Equipe</th>
                                    <th class="p-4 bg-slate-50/90 backdrop-blur text-center">Status</th>
                                    <th class="p-4 bg-slate-50/90 backdrop-blur text-right">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="divide-y divide-slate-100 text-slate-600 font-medium"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- SUBSTITUA PELAS SUAS CHAVES DO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCVbw_1Jl300_lOFBKGnRBa0Y-pptgMRe0",
            authDomain: "fiec2025-fab88.firebaseapp.com",
            databaseURL: "https://fiec2025-fab88-default-rtdb.firebaseio.com",
            projectId: "fiec2025-fab88",
            storageBucket: "fiec2025-fab88.firebasestorage.app",
            messagingSenderId: "29657094856",
            appId: "1:29657094856:web:c8a8e40aab6aa8722663fd",
            measurementId: "G-KYLG954HLH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // ESTADO
        let DADOS = { estandes: {}, marcenarias: {} };
        let estandeAtual = null;
        let isAdmin = false;
        let chartStatusInstance = null;
        let chartPendenciasInstance = null;
        const $ = (id) => document.getElementById(id);

        // --- MAPA INIT ---
        function initMapInteractions() {
            document.querySelectorAll('.estande').forEach(poly => {
                const title = poly.querySelector('title');
                if (title) poly.setAttribute('data-nome', title.textContent.trim());
                poly.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); abrirJanela(poly); });
                
                poly.addEventListener('mouseenter', () => {
                    const nome = poly.getAttribute('data-nome');
                    const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
                    const dados = DADOS.estandes[idSafe] || {};
                    const t = $('tooltip');
                    t.style.display = 'block';
                    let statusTxt = (dados.status || 'N√£o iniciado').replace('_', ' ').toUpperCase();
                    let color = '#94a3b8';
                    if(dados.status == 'concluido') color = '#10b981';
                    if(dados.status == 'construido') color = '#3b82f6';
                    
                    t.innerHTML = `
                        <div class="flex items-center gap-2 mb-1"><div class="w-2 h-2 rounded-full" style="background:${color}"></div><span class="font-bold text-sm">${nome}</span></div>
                        <div class="text-xs text-slate-300">${dados.produtor || 'Sem produtor'}</div>
                        <div class="text-[10px] font-bold mt-1 uppercase text-slate-400">${statusTxt}</div>
                    `;
                });
                poly.addEventListener('mousemove', (e) => {
                    const t = $('tooltip');
                    t.style.left = (e.pageX + 15) + 'px'; t.style.top = (e.pageY + 15) + 'px';
                });
                poly.addEventListener('mouseleave', () => $('tooltip').style.display = 'none');
            });
        }
        initMapInteractions();

        // --- AUTH ---
        $('btn-open-login').addEventListener('click', () => $('login-modal').style.display = 'flex');
        $('btn-close-login').addEventListener('click', () => $('login-modal').style.display = 'none');
        $('btn-do-login').addEventListener('click', () => {
            const email = $('login-email').value;
            const pass = $('login-pass').value;
            signInWithEmailAndPassword(auth, email, pass).then(() => $('login-modal').style.display = 'none').catch(e => {
                $('login-error').innerText = "Erro: " + e.code; $('login-error').classList.remove('hidden');
            });
        });
        $('btn-logout').addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, (user) => {
            isAdmin = !!user;
            if (user) {
                document.body.classList.add('is-admin');
                $('badge-user').innerText = "ADMIN"; $('badge-user').className = "text-[10px] bg-blue-50 text-blue-600 px-2.5 py-0.5 rounded-full border border-blue-100 font-bold uppercase tracking-wide";
                $('btn-open-login').classList.add('hidden'); $('btn-logout').classList.remove('hidden');
                $('msg-visitante').classList.add('hidden');
            } else {
                document.body.classList.remove('is-admin');
                $('badge-user').innerText = "VISITANTE"; $('badge-user').className = "text-[10px] bg-slate-100 text-slate-500 px-2.5 py-0.5 rounded-full border border-slate-200 font-bold uppercase tracking-wide";
                $('btn-open-login').classList.remove('hidden'); $('btn-logout').classList.add('hidden');
                $('msg-visitante').classList.remove('hidden');
            }
        });

        // --- SYNC ---
        onValue(ref(db), (snapshot) => {
            $('loading').style.display = 'none';
            $('app-container').classList.remove('hidden');
            const val = snapshot.val();
            DADOS = val || { estandes: {}, marcenarias: {} };
            if(!DADOS.estandes) DADOS.estandes = {};
            if(!DADOS.marcenarias) DADOS.marcenarias = {};
            renderizarTudo();
        });

        // --- COMPRESS√ÉO DE IMAGEM ---
        function compressImage(file, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxWidth = 800; // Largura maxima
                    const scaleSize = maxWidth / img.width;
                    canvas.width = maxWidth;
                    canvas.height = img.height * scaleSize;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    callback(canvas.toDataURL('image/jpeg', 0.6)); // Qualidade 60%
                }
            }
        }

        // --- GALERIA L√ìGICA ---
        $('input-photo-upload').addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                const files = Array.from(e.target.files);
                const nome = estandeAtual.getAttribute('data-nome');
                const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
                
                files.forEach(file => {
                    compressImage(file, (base64) => {
                        const currentGallery = DADOS.estandes[idSafe]?.galeria || [];
                        currentGallery.push(base64);
                        set(ref(db, `estandes/${idSafe}/galeria`), currentGallery);
                    });
                });
            }
        });

        function renderizarTudo() {
            // Marcenarias
            $('list-marcenarias').innerHTML = '';
            $('sel-marcenaria').innerHTML = '<option value="">-- Selecione --</option>';
            Object.entries(DADOS.marcenarias).forEach(([nome, cor]) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-1 bg-slate-50 border border-slate-200 px-3 py-1.5 rounded-lg text-[11px] font-bold text-slate-600 shrink-0 shadow-sm";
                div.innerHTML = `<div class="w-3 h-3 rounded-full shadow-sm" style="background:${cor}"></div> ${nome}`;
                const btnX = document.createElement('button');
                btnX.className = "ml-2 text-slate-400 hover:text-red-500 cursor-pointer admin-only transition"; btnX.innerText = "√ó";
                btnX.addEventListener('click', () => { if(confirm("Apagar?")) remove(ref(db, `marcenarias/${nome}`)); });
                div.appendChild(btnX);
                $('list-marcenarias').appendChild(div);
                const opt = document.createElement('option');
                opt.value = nome; opt.textContent = nome;
                $('sel-marcenaria').appendChild(opt);
            });

            // Mapa e Tabela
            const tbody = $('table-body');
            tbody.innerHTML = '';
            let stats = { ni: 0, obras: 0, construido: 0, concluido: 0, atrasados: 0, total: 0 };
            let pendencias = { piso: 0, eletrica: 0, mobiliario: 0, limpeza: 0, logotipia: 0, visual: 0 };
            const hoje = new Date().toISOString().split('T')[0];

            document.querySelectorAll('.estande').forEach(poly => {
                const nome = poly.getAttribute('data-nome');
                if(!nome) return;
                const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
                const dados = DADOS.estandes[idSafe] || {};
                const status = dados.status || 'nao_iniciado';

                const cor = (dados.marcenaria && DADOS.marcenarias[dados.marcenaria]);
                poly.style.fill = cor || ""; poly.style.fillOpacity = cor ? "0.6" : "";
                
                // STATUS CLASS
                poly.classList.remove('status-construido', 'status-em_construcao', 'status-atrasado', 'status-nao_iniciado', 'status-concluido');
                
                if (status === 'construido') {
                    poly.classList.add('status-construido');
                    poly.style.fill = 'rgba(59, 130, 246, 0.2)'; 
                } else if (status === 'concluido') {
                    poly.classList.add('status-concluido');
                    poly.style.fill = 'rgba(16, 185, 129, 0.6)'; // Verde mais suave para n√£o ofuscar
                    poly.style.fillOpacity = '1';
                } else {
                    poly.classList.add(`status-${status}`);
                }
                
                if (dados.data_entrega && dados.data_entrega < hoje && status !== 'concluido') {
                    poly.classList.add('status-atrasado'); stats.atrasados++;
                }

                stats.total++;
                if (status === 'nao_iniciado') stats.ni++;
                if (status === 'em_construcao') stats.obras++;
                if (status === 'construido') stats.construido++;
                if (status === 'concluido') stats.concluido++;

                if (status !== 'concluido') {
                    const chk = dados.checklist || {};
                    if (!chk.piso) pendencias.piso++;
                    if (!chk.eletrica) pendencias.eletrica++;
                    if (!chk.mobiliario) pendencias.mobiliario++;
                    if (!chk.limpeza) pendencias.limpeza++;
                    if (!chk.logotipia) pendencias.logotipia++;
                    if (!chk.visual) pendencias.visual++;
                }

                // Linha Tabela
                let statusBadge = '';
                if(status === 'concluido') statusBadge = '<span class="bg-green-100 text-green-700 px-2 py-0.5 rounded border border-green-200">ENTREGUE</span>';
                else if(status === 'construido') statusBadge = '<span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded border border-blue-200">CONSTRU√çDO</span>';
                else if(status === 'em_construcao') statusBadge = '<span class="bg-orange-100 text-orange-700 px-2 py-0.5 rounded border border-orange-200">EM OBRA</span>';
                else statusBadge = '<span class="bg-slate-100 text-slate-500 px-2 py-0.5 rounded border border-slate-200">N√ÉO INICIADO</span>';

                const tr = document.createElement('tr');
                tr.className = "hover:bg-blue-50/50 border-b border-slate-50 transition text-xs group cursor-pointer";
                tr.innerHTML = `
                    <td class="p-4 font-bold text-slate-700">${nome}</td>
                    <td class="p-4 text-slate-500">${dados.produtor || '-'}</td>
                    <td class="p-4"><div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full shadow-sm" style="background:${cor||'#cbd5e1'}"></div><span class="text-slate-600">${dados.marcenaria||'-'}</span></div></td>
                    <td class="p-4 text-center text-[10px] font-bold uppercase">${statusBadge}</td>
                    <td class="p-4 text-right"><span class="text-blue-600 font-bold opacity-0 group-hover:opacity-100 cursor-pointer transition text-[10px] bg-blue-50 px-2 py-1 rounded">EDITAR</span></td>
                `;
                tr.addEventListener('click', () => abrirJanela(poly));
                tbody.appendChild(tr);
            });

            // Atualiza Dashboard
            $('dash-total-big').innerText = stats.total;
            $('dash-concluido').innerText = stats.concluido;
            $('dash-construido').innerText = stats.construido;
            $('dash-obra').innerText = stats.obras;
            $('dash-ni').innerText = stats.ni;
            $('last-update').innerText = "Atualizado: " + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});

            const totalPend = Object.values(pendencias).reduce((a,b)=>a+b,0);
            $('total-pendencias').innerText = totalPend + " pend√™ncias";

            updateCharts(stats, pendencias);
            aplicarBusca($('search-input').value);
        }

        function updateCharts(stats, pendencias) {
            // Chart.js defaults
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#64748b';

            // PIZZA
            const ctxStatus = $('chart-status').getContext('2d');
            if (chartStatusInstance) chartStatusInstance.destroy();
            chartStatusInstance = new Chart(ctxStatus, {
                type: 'doughnut',
                data: {
                    labels: ['Entregue', 'Constru√≠do', 'Em Obra', 'N/I'],
                    datasets: [{
                        data: [stats.concluido, stats.construido, stats.obras, stats.ni],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#cbd5e1'],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverOffset: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', padding: 10, cornerRadius: 8 } }, cutout: '75%' }
            });

            // BARRAS HORIZONTAIS (Pend√™ncias)
            const ctxPend = $('chart-pendencias').getContext('2d');
            if (chartPendenciasInstance) chartPendenciasInstance.destroy();
            chartPendenciasInstance = new Chart(ctxPend, {
                type: 'bar',
                data: {
                    labels: ['Piso', 'El√©trica/Luz', 'Mobili√°rio', 'Limp', 'Logotipia', 'Comunica√ß√£o Visual'],
                    datasets: [{
                        label: 'Faltam',
                        data: [pendencias.piso, pendencias.eletrica, pendencias.mobiliario, pendencias.limpeza, pendencias.logotipia, pendencias.visual],
                        backgroundColor: '#ef4444',
                        borderRadius: 4,
                        barThickness: 12
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    indexAxis: 'x', 
                    plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', padding: 10, cornerRadius: 8 } }, 
                    scales: { 
                        x: { grid: { display: false }, ticks: { font: { size: 10, weight: '600' } } }, 
                        y: { display: false, beginAtZero: true } 
                    } 
                }
            });
        }

        // --- JANELA MODAL ---
        function abrirJanela(poly) {
            estandeAtual = poly;
            const nome = poly.getAttribute('data-nome');
            const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
            const dados = DADOS.estandes[idSafe] || {};

            $('modal-title').innerText = nome;
            $('badge-status-modal').innerText = (dados.status || 'N√£o iniciado').replace('_', ' ');
            
            // Set values
            $('inp-produtor').value = dados.produtor || '';
            $('inp-data').value = dados.data_entrega || '';
            $('sel-marcenaria').value = dados.marcenaria || '';
            $('sel-status').value = dados.status || 'nao_iniciado';
            $('inp-obs').value = dados.obs || '';
            $('inp-link').value = dados.link_drive || '';

            // Checklist checkboxes
            const checks = dados.checklist || {};
            document.querySelectorAll('.chk-task').forEach(chk => { chk.checked = !!checks[chk.value]; });

            // LOGICA DRIVE (Dual check: DB + SVG)
            let link = dados.link_drive;
            if (!link || link === "") {
                // Tenta achar o link no SVG se n√£o tiver no banco
                const parentLink = poly.closest('a');
                if (parentLink) link = parentLink.getAttribute('href') || parentLink.getAttribute('xlink:href');
            }

            const btn = $('btn-drive-action');
            const imgContainer = $('img-preview-container');
            const imgPreview = $('img-preview');
            const btnViewPhoto = $('btn-view-photo');

            // Reset inicial
            btn.classList.add('hidden'); btn.classList.remove('flex');
            imgContainer.classList.add('hidden');

            if (link && link.trim() !== "" && link !== "#") {
                // Se for imagem (termina com jpg, png, etc) mostra preview
                if (link.match(/\.(jpeg|jpg|gif|png)$/) != null) {
                    imgContainer.classList.remove('hidden'); imgPreview.src = link; btnViewPhoto.href = link;
                } else {
                    // Se for link normal (pasta)
                    btn.href = link;
                    btn.classList.remove('hidden');
                    btn.classList.add('flex');
                }
            }

            // Galeria
            const galeriaContainer = $('gallery-container');
            const noPhotosMsg = $('no-photos-msg');
            galeriaContainer.innerHTML = '';
            if (dados.galeria && dados.galeria.length > 0) {
                noPhotosMsg.classList.add('hidden');
                dados.galeria.forEach((fotoBase64, index) => {
                    const div = document.createElement('div');
                    div.className = 'gallery-item';
                    div.innerHTML = `<img src="${fotoBase64}" onclick="window.open('${fotoBase64}')">`;
                    const btnDel = document.createElement('div');
                    btnDel.className = 'btn-remove-img admin-only'; btnDel.innerHTML = '<i class="fa-solid fa-times"></i>';
                    btnDel.onclick = (e) => { e.stopPropagation(); if(confirm('Excluir?')) { const novaGaleria = dados.galeria.filter((_, i) => i !== index); set(ref(db, `estandes/${idSafe}/galeria`), novaGaleria); } };
                    div.appendChild(btnDel);
                    galeriaContainer.appendChild(div);
                });
            } else { noPhotosMsg.classList.remove('hidden'); }

            // Resetar aba para a primeira
            document.querySelectorAll('.tab-content, .tab-btn').forEach(c => c.classList.remove('active'));
            $('tab-dados').classList.add('active');
            document.querySelector('[data-tab="tab-dados"]').classList.add('active');

            // WhatsApp Logic
            $('btn-whatsapp').onclick = () => {
                const pend = [];
                document.querySelectorAll('.chk-task:not(:checked)').forEach(c => pend.push(c.parentNode.querySelector('span').innerText));
                const text = `*Relat√≥rio Estande: ${nome}*\nüìä Status: ${dados.status}\nüë§ Produtor: ${dados.produtor||'-'}\nüìù Pend√™ncias: ${pend.length > 0 ? pend.join(', ') : 'Nenhuma'}\nOBS: ${dados.obs||'-'}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            };

            $('modal-estande').style.display = 'flex';
        }

        // TABS LOGIC
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        $('btn-close-modal').addEventListener('click', () => $('modal-estande').style.display = 'none');

        // BOT√ÉO QUICK FINISH
        $('btn-quick-finish').addEventListener('click', () => {
             if(!estandeAtual) return;
             const nome = estandeAtual.getAttribute('data-nome');
             const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
             // Marca tudo check
             let checklistData = { piso: true, eletrica: true, mobiliario: true, limpeza: true, logotipia: true, visual: true };
             set(ref(db, `estandes/${idSafe}`), { ...DADOS.estandes[idSafe], status: 'concluido', checklist: checklistData });
             $('modal-estande').style.display = 'none';
        });

        $('btn-save').addEventListener('click', () => {
            if(!estandeAtual) return;
            const nome = estandeAtual.getAttribute('data-nome');
            const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
            let checklistData = {};
            document.querySelectorAll('.chk-task').forEach(chk => checklistData[chk.value] = chk.checked);
            
            // Preserva galeria existente ao salvar outros dados
            const galeriaExistente = DADOS.estandes[idSafe]?.galeria || [];

            set(ref(db, `estandes/${idSafe}`), {
                produtor: $('inp-produtor').value,
                data_entrega: $('inp-data').value,
                marcenaria: $('sel-marcenaria').value,
                status: $('sel-status').value,
                link_drive: $('inp-link').value,
                obs: $('inp-obs').value,
                checklist: checklistData,
                galeria: galeriaExistente
            });
            $('modal-estande').style.display = 'none';
        });

        $('btn-delete').addEventListener('click', () => {
            if(!estandeAtual) return;
            if(confirm("Limpar dados deste estande?")) {
                const nome = estandeAtual.getAttribute('data-nome');
                const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
                remove(ref(db, `estandes/${idSafe}`));
                $('modal-estande').style.display = 'none';
            }
        });

        $('btn-add-marcenaria').addEventListener('click', () => {
            const nome = $('new-marcenaria-name').value.trim();
            const cor = $('new-marcenaria-color').value;
            if(nome) {
                set(ref(db, `marcenarias/${nome}`), cor);
                $('new-marcenaria-name').value = '';
            }
        });

        $('btn-reset-db').addEventListener('click', () => {
            if(confirm("ATEN√á√ÉO: APAGAR TUDO?")) set(ref(db), { estandes: {}, marcenarias: {} });
        });

        $('btn-pdf').addEventListener('click', () => {
            if(!estandeAtual) return;
            const nome = estandeAtual.getAttribute('data-nome');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(`Ficha: ${nome}`, 10, 20);
            doc.text(`Produtor: ${$('inp-produtor').value}`, 10, 30);
            doc.text(`Status: ${$('sel-status').value}`, 10, 40);
            doc.text(`Obs: ${$('inp-obs').value}`, 10, 50);
            doc.save(`Ficha_${nome}.pdf`);
        });

        function aplicarBusca(texto) {
            const t = texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            document.querySelectorAll('.estande').forEach(poly => {
                const nome = poly.getAttribute('data-nome');
                const idSafe = nome.replace(/[.#$[\]\/]/g, "_");
                const dados = DADOS.estandes[idSafe] || {};
                const conteudo = `${nome} ${dados.produtor||''} ${dados.marcenaria||''}`.toLowerCase();
                
                if(t === "" || conteudo.includes(t)) {
                    poly.classList.remove('estande-dimmed');
                    if(t !== "") poly.classList.add('estande-match'); else poly.classList.remove('estande-match');
                } else {
                    poly.classList.add('estande-dimmed');
                    poly.classList.remove('estande-match');
                }
            });
            Array.from($('table-body').rows).forEach(tr => {
                tr.style.display = tr.innerText.toLowerCase().includes(t) ? '' : 'none';
            });
        }
        $('search-input').addEventListener('input', (e) => aplicarBusca(e.target.value));

        const filtrarPorStatus = (filtro) => {
            document.querySelectorAll('.estande').forEach(poly => {
                const idSafe = poly.getAttribute('data-nome').replace(/[.#$[\]\/]/g, "_");
                const dados = DADOS.estandes[idSafe] || {};
                const status = dados.status || 'nao_iniciado';
                
                // L√≥gica de Link para filtro "Sem Drive"
                let linkDB = dados.link_drive || "";
                let linkSVG = "";
                const parent = poly.closest('a');
                if (parent) linkSVG = parent.getAttribute('href') || parent.getAttribute('xlink:href') || "";
                if (linkSVG === "#") linkSVG = "";

                let ok = true;
                if(filtro === 'atrasados') {
                    const hoje = new Date().toISOString().split('T')[0];
                    ok = (dados.data_entrega && dados.data_entrega < hoje && status !== 'concluido');
                } else if(filtro === 'sem_drive') {
                    ok = (linkDB.trim() === "" && linkSVG.trim() === "");
                } else if(filtro !== 'todos') {
                    ok = (status === filtro);
                }
                
                if(ok) poly.classList.remove('estande-dimmed');
                else poly.classList.add('estande-dimmed');
            });
            
            // Sincroniza a tabela abaixo para mostrar apenas os filtrados
            Array.from($('table-body').rows).forEach(tr => {
                const nomeEstande = tr.cells[0].innerText;
                const poly = document.querySelector(`[data-nome="${nomeEstande}"]`);
                const estaVisivelNoMapa = poly && !poly.classList.contains('estande-dimmed');
                
                tr.style.display = estaVisivelNoMapa ? '' : 'none';
            });
        };

        $('flt-todos').onclick = () => filtrarPorStatus('todos');
        $('flt-atrasados').onclick = () => filtrarPorStatus('atrasados');
        $('flt-obras').onclick = () => filtrarPorStatus('em_construcao');
        $('flt-prontos').onclick = () => filtrarPorStatus('concluido'); // Corrigido para 'concluido'
        $('flt-sem-drive').onclick = () => filtrarPorStatus('sem_drive');

        $('btn-export-xls').addEventListener('click', () => {
             let csv = "\uFEFFEstande;Produtor;Marcenaria;Status;Entrega;Obs\n";
             Object.entries(DADOS.estandes).forEach(([id, d]) => {
                 csv += `${id};${d.produtor};${d.marcenaria};${d.status};${d.data_entrega};${d.obs}\n`;
             });
             const link = document.createElement("a");
             link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
             link.download = "Relatorio.csv";
             link.click();
        });

    </script>
</body>
</html>